import{r as c,R as v,e as I,j as e,p as w,g as A,m as x}from"./index-Bh_Q_c63.js";import{g as D,a as E,c as N,b as y,G as R}from"./FavoriteButton-DQve410x.js";import{S as G,a as O}from"./SharkSelector-Cw-3bzf7.js";import"./three.module-BTTigmqi.js";import"./linear-BcwBMSNj.js";import"./OrbitControls-C22u-Lz6.js";const M=new Set(["Africa","Antarctica","Asia","Europe","North America","Oceania","South America"]);function P({sharks:o,onSelect:i,selectedSharkId:S}){const[u,m]=c.useState({}),g=v.useMemo(()=>{const s={};return o.forEach(n=>{I(n.continent).forEach(a=>{M.has(a)&&(s[a]||(s[a]=[]),s[a].push(n))})}),console.log("Sharks by continent:",Object.keys(s).map(n=>`${n}: ${s[n].length}`).join(", ")),s},[o]),l=s=>{m(n=>({...n,[s]:!n[s]}))};return e.jsx("div",{className:"scrollable-sharks-list",children:Object.keys(g).length===0?e.jsx("div",{className:"no-sharks-message",children:"Sorry! No whale sharks match your current filters."}):Object.entries(g).sort(([s],[n])=>s.localeCompare(n)).map(([s,n])=>{const r=u[s];return e.jsxs("div",{className:"continent-dropdown",children:[e.jsxs("div",{className:"continent-header",onClick:()=>l(s),children:[s," ",r?"▾":"▸"]}),r&&e.jsx("div",{className:"scrollable-shark-list",children:n.map(a=>e.jsx("div",{className:`shark-selector-item ${a.id===S?"selected":""}`,onClick:()=>i(a.id),children:(()=>{const d=w(a.countries.trim()),t=A(d);return e.jsxs(e.Fragment,{children:[t?e.jsxs("div",{className:"flag-and-code",children:[e.jsx("img",{src:`https://flagcdn.com/24x18/${t}.png`,alt:d,title:d,className:"flag-icon",loading:"lazy"}),e.jsx("span",{className:"country-code",children:t.toUpperCase()})]}):e.jsxs("span",{className:"flag-and-code",title:d,role:"img","aria-label":"unknown country",children:["🌍 ",e.jsx("span",{className:"country-code",children:"N/A"})]}),a.id]})})()},a.id))})]},s)})})}function B(){const[o,i]=c.useState(null),[S,u]=c.useState(!0),[m,g]=c.useState(x),l=c.useRef(),s=c.useMemo(()=>D(),[]),n=c.useMemo(()=>{if(m.length===x.length)return s;const t=m.map(h=>h.id);return E(t)},[m,s]),r=x;c.useEffect(()=>{if(o){if(l.current){const t=l.current.getGlobe();N(t),l.current.highlightShark(o.id)}u(!1)}else{if(l.current){const t=l.current.getGlobe();N(t),y(t,n)}u(!0)}},[o,n]),c.useEffect(()=>{if(l.current){const t=l.current.getGlobe();N(t),y(t,n)}},[n]);const a=t=>{if(typeof t=="object"&&t.lat!==void 0&&t.lng!==void 0){if(!S){console.log("Ignoring click because not all sharks are visible.");return}const{lat:h,lng:p}=t;console.log("Clicked at lat/lng:",h,p);const C=3,b=n.find(f=>{const k=Math.abs(f.lat-h),j=Math.abs(f.lng-p);return k<C&&j<C});if(b){const f=b.id.split("-")[0];console.log("Matched shark:",b.id," with ID: ",f);const k=r.find(j=>j.id==f)||null;console.log("Sending shark obect:",k),i(k)}else console.log("No nearby shark found."),i(null)}else{const h=r.find(p=>p.id==t)||null;i(h)}},d=()=>{i(null),u(!0)};return e.jsx("div",{className:"page-content globeviews-wrapper",children:e.jsxs("div",{className:"globe-views-container",children:[e.jsx("div",{className:"info-sidebar",children:e.jsx(G,{shark:o})}),e.jsx("div",{className:"globe-container",children:e.jsx(R,{ref:l,onSharkClick:a,allowClicks:!o})}),e.jsx("div",{className:"shark-selector",children:e.jsx(O,{sharks:r,onSelect:a,onReset:d,selectedSharkId:o?o.id:null,DisplayComponent:P,onFilteredSharksChange:g})})]})})}export{B as default};
