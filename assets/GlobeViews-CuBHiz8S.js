import{r as j,j as e,R}from"./index-BgixkTYc.js";import{p as B,g as L,a as y,b as T,e as G,c as H,d as P,f as $,h as E,i as O,G as V,m as W}from"./DataUtils-Cr5nJr43.js";import"./three.module-BY-9PNfi.js";import"./linear-BcwBMSNj.js";import"./OrbitControls-DpXFg4GH.js";import"./country-list-CMU6V2HV.js";const F=({shark:s})=>{const[n,l]=j.useState(null),t=s&&s.image!=="Unknown"?B(s.image):[],a=i=>l(i),r=()=>l(null);if(j.useEffect(()=>{if(n===null)return;const i=d=>{d.key==="ArrowLeft"?l(m=>Math.max(m-1,0)):d.key==="ArrowRight"?l(m=>Math.min(m+1,t.length-1)):d.key==="Escape"&&r()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[n,t.length]),!s)return e.jsxs("div",{className:"shark-info-panel",children:[e.jsx("h2",{children:"All Sharks Overview"}),e.jsx("p",{children:"Select a shark to view detailed tracking information."})]});const c=s.countries.split(",").map(i=>i.trim()),g=s.regions?s.regions.split(",").map(i=>i.trim()):[],b=s.publishing?s.publishing.split(",").map(i=>i.trim()):[],h=s.remarks?s.remarks.split(",").map(i=>i.trim()):[];return e.jsxs("div",{className:"shark-info-panel",children:[e.jsxs("h2",{children:["ID: ",s.id]}),e.jsxs("div",{className:"shark-panel-details",children:[e.jsxs("div",{className:"shark-traits",children:[e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Sex:"}),"Â  ",s.sex]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Life Stage:"}),"Â  ",s.lifeStage]})]}),e.jsxs("div",{className:"shark-records",children:[e.jsxs("h3",{className:"shark-details",children:[e.jsx("strong",{children:"Total Records:"}),"Â  ",s.occurrences]}),e.jsxs("p",{className:"shark-details",children:[s.oldest," Â ...Â  ",s.newest]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Satellite tracking:"}),"Â Â ",Math.round(s.machine/(s.machine+s.human)*100),"%"]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Human sightings:"}),"Â Â ",Math.round(s.human/(s.machine+s.human)*100),"%"]})]}),e.jsxs("div",{className:"shark-regions",children:[e.jsx("h3",{className:"shark-details",children:"Places Visited"}),e.jsx("ul",{className:"timeline-list",children:c.map((i,d)=>{const m=g[d]||"Unknown",f=b[d]||"Unspecified",u=h[d]||"None",p=L(m),v=L(i),w=p!=="Unknown"?p:v;return e.jsxs("li",{className:"timeline-item",children:[e.jsxs("div",{className:"timeline-header",children:[e.jsx("strong",{children:y(i)})," ",e.jsxs("span",{className:"timeline-date",children:["(",w,")"]})]}),e.jsxs("div",{className:"timeline-region",children:[e.jsx("span",{className:"timeline-label",children:"Region:"})," ",e.jsx("em",{children:m!=="Unknown"?y(m):"Unspecified"})]}),e.jsxs("div",{className:"timeline-meta",children:[e.jsx("span",{className:"timeline-label",children:"Published by:"})," ",e.jsx("em",{children:f!=="Unknown"?f:"Unspecified"})]}),e.jsxs("div",{className:"timeline-remarks",children:[e.jsx("span",{className:"timeline-label",children:"Sighting remarks:"})," ",e.jsx("em",{children:u!=="Unknown"?T(u):"None"})]})]},d)})})]}),e.jsxs("div",{className:"shark-images-container",children:[e.jsx("h3",{children:"Media Gallery"}),t.length>0?t.map((i,d)=>e.jsxs("div",{className:"shark-image-card",children:[e.jsx("img",{src:i.url,alt:`Shark image ${d}`,onClick:()=>a(d),style:{cursor:"pointer"}}),e.jsx("p",{className:"shark-image-meta",children:e.jsxs("small",{children:["ðŸ“¸ Creator: ",i.creator," | ",i.license]})})]},d)):e.jsx("p",{children:"No media available."})]})]}),n!==null&&e.jsx("div",{className:"image-overlay",onClick:r,children:e.jsxs("div",{className:"overlay-content",onClick:i=>i.stopPropagation(),children:[e.jsx("button",{className:"carousel-button left",onClick:()=>l(i=>Math.max(i-1,0)),disabled:n===0,children:"< "}),e.jsxs("div",{className:"overlay-image-wrapper",children:[e.jsx("img",{src:t[n].url,alt:`Expanded shark image ${n}`}),e.jsxs("p",{className:"overlay-meta",children:["ðŸ“¸ Creator: ",t[n].creator," | ",t[n].license]})]}),e.jsx("button",{className:"carousel-button right",onClick:()=>l(i=>Math.min(i+1,t.length-1)),disabled:n===t.length-1,children:"> "}),e.jsx("button",{className:"close-button",onClick:r,children:"X"})]})})]})},J=new Set(["Africa","Antarctica","Asia","Europe","North America","Oceania","South America"]);function U(s,n){return Array.from(new Set(s.flatMap(l=>{var t;return((t=l[n])==null?void 0:t.split(",").map(a=>y(a).trim()).filter(Boolean))||[]}))).sort((l,t)=>l.localeCompare(t))}function Y(s,n){return s.filter(l=>{var t;if(n.showOnlyWithMedia&&!(l.image&&l.image.trim()!==""&&l.image!=="Unknown")||n.country&&!(l.countries||"").split(",").map(c=>y(c).toLowerCase().trim()).some(c=>c.includes(n.country.toLowerCase()))||n.publishingCountry&&!(l.publishing||"").split(",").map(c=>y(c).toLowerCase().trim()).some(c=>c.includes(n.publishingCountry.toLowerCase())))return!1;if(n.yearRange){const a=parseInt(l.oldest),r=parseInt(l.newest),c=parseInt(n.yearRange[0]),g=parseInt(n.yearRange[1]);if(isNaN(a)||isNaN(r)||r<c||a>g)return!1}if(n.hasOccurrenceNotes&&T(l.remarks)==="None"||n.minRecords>0&&l.occurrences<n.minRecords||n.sex&&(((t=l.sex)==null?void 0:t.toLowerCase())||"")!==n.sex.toLowerCase()||n.lifeStage&&P(l).toLowerCase()!==n.lifeStage.toLowerCase())return!1;if(n.observationType){let a=!0;if(n.observationType=="Satellite"?a=l.machine>0:n.observationType=="Human"&&(a=l.human>0),!a)return!1}return!0})}function _({filters:s,setFilters:n}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Media"}),e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.showOnlyWithMedia,onChange:()=>n(l=>({...l,showOnlyWithMedia:!l.showOnlyWithMedia}))}),"Sharks with real-world images"]})]})}function q({filters:s,setFilters:n,COUNTRIES:l,PUBLISHING_COUNTRIES:t}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Location"}),e.jsxs("label",{className:"filter-label",children:["Country:",e.jsxs("select",{value:s.country,onChange:a=>n(r=>({...r,country:a.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),l.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("label",{className:"filter-label",children:["Publishing Country:",e.jsxs("select",{value:s.publishingCountry,onChange:a=>n(r=>({...r,publishingCountry:a.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),t.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]})}function z({filters:s,setFilters:n,MIN_YEAR:l,MAX_YEAR:t}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Time"}),e.jsxs("label",{className:"filter-label",children:["Year Range:",e.jsxs("div",{className:"range-inputs",children:[e.jsx("input",{type:"number",value:s.yearRange[0],onChange:a=>{const r=a.target.value;n(c=>({...c,yearRange:[r,c.yearRange[1]]}))},onBlur:()=>{n(a=>{const r=parseInt(a.yearRange[0]),c=isNaN(r)?l:Math.max(l,Math.min(r,parseInt(a.yearRange[1])));return{...a,yearRange:[String(c),a.yearRange[1]]}})},className:"filter-input"}),e.jsx("span",{style:{margin:"0 0.25rem"},children:"to"}),e.jsx("input",{type:"number",value:s.yearRange[1],onChange:a=>{const r=a.target.value;n(c=>({...c,yearRange:[c.yearRange[0],r]}))},onBlur:()=>{n(a=>{const r=parseInt(a.yearRange[1]),c=isNaN(r)?t:Math.min(t,Math.max(r,parseInt(a.yearRange[0])));return{...a,yearRange:[a.yearRange[0],String(c)]}})},className:"filter-input"})]})]})]})}function K({filters:s,setFilters:n,MIN_RECORDS:l,MAX_RECORDS:t}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Metadata"}),e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.hasOccurrenceNotes,onChange:()=>n(a=>({...a,hasOccurrenceNotes:!a.hasOccurrenceNotes}))}),"Sharks with occurrence notes"]}),e.jsxs("label",{className:"filter-label",children:["Min Records:",e.jsx("input",{type:"number",min:l,max:t,value:s.minRecords,onChange:a=>{const r=a.target.value;n(c=>({...c,minRecords:r}))},onBlur:()=>{n(a=>{const r=parseInt(a.minRecords,10);if(isNaN(r))return{...a,minRecords:l};const c=Math.max(l,Math.min(r,t));return{...a,minRecords:c}})},className:"filter-input"})]})]})}function X({filters:s,setFilters:n}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Biological"}),e.jsxs("label",{className:"filter-label",children:["Sex:",e.jsxs("select",{value:s.sex,onChange:l=>n(t=>({...t,sex:l.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"filter-label",children:["Life Stage:",e.jsxs("select",{value:s.lifeStage,onChange:l=>n(t=>({...t,lifeStage:l.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Juvenile",children:"Juvenile"}),e.jsx("option",{value:"Subadult",children:"Subadult"}),e.jsx("option",{value:"Adult",children:"Adult"}),e.jsx("option",{value:"Unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"filter-label",children:["Observation Type:",e.jsxs("select",{value:s.observationType,onChange:l=>n(t=>({...t,observationType:l.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Satellite",children:"Satellite Tracking"}),e.jsx("option",{value:"Human",children:"Human Sightings"})]})]})]})}function Q({filters:s,setFilters:n,COUNTRIES:l,PUBLISHING_COUNTRIES:t,MIN_YEAR:a,MAX_YEAR:r,MIN_RECORDS:c,MAX_RECORDS:g}){return e.jsxs("div",{className:"shark-filters scrollable-filters",children:[_({filters:s,setFilters:n}),q({filters:s,setFilters:n,COUNTRIES:l,PUBLISHING_COUNTRIES:t}),z({filters:s,setFilters:n,MIN_YEAR:a,MAX_YEAR:r}),K({filters:s,setFilters:n,MIN_RECORDS:c,MAX_RECORDS:g}),X({filters:s,setFilters:n})]})}function Z({sharks:s,onReset:n,onSelect:l,selectedSharkId:t}){const a=U(s,"countries"),r=U(s,"publishing"),c=Math.min(...s.map(o=>o.occurrences||1)),g=Math.max(...s.map(o=>o.occurrences||1)),b=s.flatMap(o=>[parseInt(o.oldest),parseInt(o.newest)]).filter(o=>!isNaN(o)),h=Math.min(...b),i=Math.max(...b),d={showOnlyWithMedia:!1,country:"",yearRange:[String(h),String(i)],hasOccurrenceNotes:!1,minRecords:1,sex:"",lifeStage:"",publishingCountry:"",observationType:""},[m,f]=R.useState(d),[u,p]=j.useState(!0),v=()=>{f(d),p(!1),M({}),n&&n()},[w,M]=j.useState({}),I=R.useMemo(()=>Y(s,m),[s,m]),A=R.useMemo(()=>{const o={};return I.forEach(N=>{G(N.continent).forEach(x=>{J.has(x)&&(o[x]||(o[x]=[]),o[x].push(N))})}),o},[I]),D=o=>{M(N=>({...N,[o]:!N[o]}))};return e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{className:"shark-selector-list",children:[e.jsx("button",{onClick:v,className:`show-all-button ${t==null?"active":""}`,children:"Show All Sharks"}),e.jsxs("div",{className:"filter-toggle-container",children:[e.jsx("button",{onClick:()=>p(o=>!o),className:`toggle-filter-button ${u?"active":""}`,children:u?"Hide Filters â–²":"Show Filters â–¼"}),u&&Q({filters:m,setFilters:f,COUNTRIES:a,PUBLISHING_COUNTRIES:r,MIN_YEAR:h,MAX_YEAR:i,MIN_RECORDS:c,MAX_RECORDS:g})]}),e.jsx("div",{className:"scrollable-sharks-list",children:Object.keys(A).length===0?e.jsx("div",{className:"no-sharks-message",children:"Sorry! No whale sharks match your current filters."}):Object.entries(A).sort(([o],[N])=>o.localeCompare(N)).map(([o,N])=>{const k=w[o];return e.jsxs("div",{className:"continent-dropdown",children:[e.jsxs("div",{className:"continent-header",onClick:()=>D(o),children:[o," ",k?"â–¾":"â–¸"]}),k&&e.jsx("div",{className:"continent-shark-list",children:N.map(x=>e.jsx("div",{className:`shark-selector-item ${x.id===t?"selected":""}`,onClick:()=>l(x.id),children:(()=>{const S=y(x.countries.trim()),C=H(S);return e.jsxs(e.Fragment,{children:[C?e.jsxs("div",{className:"flag-and-code",children:[e.jsx("img",{src:`https://flagcdn.com/24x18/${C}.png`,alt:S,title:S,className:"flag-icon",loading:"lazy"}),e.jsx("span",{className:"country-code",children:C.toUpperCase()})]}):e.jsxs("span",{className:"flag-and-code",title:S,role:"img","aria-label":"unknown country",children:["ðŸŒ ",e.jsx("span",{className:"country-code",children:"N/A"})]}),x.id]})})()},x.id))})]},o)})})]})})}function ie(){const[s,n]=j.useState(null),[l,t]=j.useState(!0),a=j.useRef(),r=j.useMemo(()=>$(),[]),c=W;j.useEffect(()=>{var h;if(s)(h=a.current)==null||h.highlightShark(s.id),t(!1);else{if(a.current){const i=a.current.getGlobe();E(i),O(i,r)}t(!0)}},[s]),j.useEffect(()=>{if(a.current){const h=a.current.getGlobe();E(h),O(h,r)}},[]);const g=h=>{if(typeof h=="object"&&h.lat!==void 0&&h.lng!==void 0){if(!l){console.log("Ignoring click because not all sharks are visible.");return}const{lat:i,lng:d}=h;console.log("Clicked at lat/lng:",i,d);const m=3,f=r.find(u=>{const p=Math.abs(u.lat-i),v=Math.abs(u.lng-d);return p<m&&v<m});if(f){const u=f.id.split("-")[0];console.log("Matched shark:",f.id," with ID: ",u);const p=c.find(v=>v.id==u)||null;console.log("Sending shark obect:",p),n(p)}else console.log("No nearby shark found."),n(null)}else{const i=c.find(d=>d.id==h)||null;n(i)}},b=()=>{n(null),t(!0)};return e.jsx("div",{className:"page-content globeviews-wrapper",children:e.jsxs("div",{className:"globe-views-container",children:[e.jsx("div",{className:"info-sidebar",children:e.jsx(F,{shark:s})}),e.jsx("div",{className:"globe-container",children:e.jsx(V,{ref:a,onSharkClick:g,allowClicks:!s})}),e.jsx("div",{className:"shark-selector",children:e.jsx(Z,{sharks:c,onSelect:g,onReset:b,selectedSharkId:s?s.id:null})})]})})}export{ie as default};
