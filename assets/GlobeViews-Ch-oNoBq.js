import{r as x,j as e}from"./index-CzJ7J1CT.js";import{p as w,g as k,a as N,b as y,e as C,c as E,d as I,f as b,h as v,G as A,m as D}from"./DataUtils-DSwLDMpp.js";import"./three.module-Bsgt3Dte.js";import"./linear-BcwBMSNj.js";import"./OrbitControls-B1yeR1PJ.js";import"./country-list-CMU6V2HV.js";const M=({shark:n})=>{const[i,h]=x.useState(null),t=n&&n.image!=="Unknown"?w(n.image):[],m=s=>h(s),u=()=>h(null);if(x.useEffect(()=>{if(i===null)return;const s=a=>{a.key==="ArrowLeft"?h(l=>Math.max(l-1,0)):a.key==="ArrowRight"?h(l=>Math.min(l+1,t.length-1)):a.key==="Escape"&&u()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[i,t.length]),!n)return e.jsxs("div",{className:"shark-info-panel",children:[e.jsx("h2",{children:"All Sharks Overview"}),e.jsx("p",{children:"Select a shark to view detailed tracking information."})]});const g=n.countries.split(",").map(s=>s.trim()),p=n.regions?n.regions.split(",").map(s=>s.trim()):[],f=n.publishing?n.publishing.split(",").map(s=>s.trim()):[],c=n.remarks?n.remarks.split(",").map(s=>s.trim()):[];return e.jsxs("div",{className:"shark-info-panel",children:[e.jsxs("h2",{children:["ID: ",n.id]}),e.jsxs("div",{className:"shark-panel-details",children:[e.jsxs("div",{className:"shark-traits",children:[e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Sex:"}),"  ",n.sex]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Life Stage:"}),"  ",n.lifeStage]})]}),e.jsxs("div",{className:"shark-records",children:[e.jsxs("h3",{className:"shark-details",children:[e.jsx("strong",{children:"Total Records:"}),"  ",n.occurrences]}),e.jsxs("p",{className:"shark-details",children:[n.oldest,"  ...  ",n.newest]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Satellite tracking:"}),"  ",Math.round(n.machine/(n.machine+n.human)*100),"%"]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Human sightings:"}),"  ",Math.round(n.human/(n.machine+n.human)*100),"%"]})]}),e.jsxs("div",{className:"shark-regions",children:[e.jsx("h3",{className:"shark-details",children:"Places Visited"}),e.jsx("ul",{className:"timeline-list",children:g.map((s,a)=>{const l=p[a]||"Unknown",r=f[a]||"Unspecified",o=c[a]||"None",d=k(l),j=k(s),S=d!=="Unknown"?d:j;return e.jsxs("li",{className:"timeline-item",children:[e.jsxs("div",{className:"timeline-header",children:[e.jsx("strong",{children:N(s)})," ",e.jsxs("span",{className:"timeline-date",children:["(",S,")"]})]}),e.jsxs("div",{className:"timeline-region",children:[e.jsx("span",{className:"timeline-label",children:"Region:"})," ",e.jsx("em",{children:l!=="Unknown"?N(l):"Unspecified"})]}),e.jsxs("div",{className:"timeline-meta",children:[e.jsx("span",{className:"timeline-label",children:"Published by:"})," ",e.jsx("em",{children:r!=="Unknown"?r:"Unspecified"})]}),e.jsxs("div",{className:"timeline-remarks",children:[e.jsx("span",{className:"timeline-label",children:"Sighting remarks:"})," ",e.jsx("em",{children:o!=="Unknown"?y(o):"None"})]})]},a)})})]}),e.jsxs("div",{className:"shark-images-container",children:[e.jsx("h3",{children:"Media Gallery"}),t.length>0?t.map((s,a)=>e.jsxs("div",{className:"shark-image-card",children:[e.jsx("img",{src:s.url,alt:`Shark image ${a}`,onClick:()=>m(a),style:{cursor:"pointer"}}),e.jsx("p",{className:"shark-image-meta",children:e.jsxs("small",{children:["📸 Creator: ",s.creator," | ",s.license]})})]},a)):e.jsx("p",{children:"No media available."})]})]}),i!==null&&e.jsx("div",{className:"image-overlay",onClick:u,children:e.jsxs("div",{className:"overlay-content",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"carousel-button left",onClick:()=>h(s=>Math.max(s-1,0)),disabled:i===0,children:"< "}),e.jsxs("div",{className:"overlay-image-wrapper",children:[e.jsx("img",{src:t[i].url,alt:`Expanded shark image ${i}`}),e.jsxs("p",{className:"overlay-meta",children:["📸 Creator: ",t[i].creator," | ",t[i].license]})]}),e.jsx("button",{className:"carousel-button right",onClick:()=>h(s=>Math.min(s+1,t.length-1)),disabled:i===t.length-1,children:"> "}),e.jsx("button",{className:"close-button",onClick:u,children:"X"})]})})]})},R=new Set(["Africa","Antarctica","Asia","Europe","North America","Oceania","South America"]);function U({sharks:n,onReset:i,onSelect:h,selectedSharkId:t}){const[m,u]=x.useState({}),g={},[p,f]=x.useState(!1);(p?n.filter(a=>a.image&&a.image!=="Unknown"&&a.image.trim()!==""):n).forEach(a=>{C(a.continent).forEach(r=>{R.has(r)&&(g[r]||(g[r]=[]),g[r].push(a))})});const s=a=>{u(l=>({...l,[a]:!l[a]}))};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx("button",{onClick:i,className:t==null?"active":"",children:e.jsx("span",{className:"all-sharks-button-text",children:"Show All Sharks"})}),e.jsxs("div",{className:"shark-selector-list",children:[e.jsx("div",{className:"media-toggle-container",children:e.jsxs("label",{style:{margin:"0.5rem 0 1rem",fontSize:"0.9rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>f(!p),style:{marginRight:"0.5rem"}}),"Show only sharks with ",e.jsx("strong",{children:"MEDIA"})]})}),e.jsx("div",{className:"scrollable-sharks-list",children:Object.entries(g).sort(([a],[l])=>a.localeCompare(l)).map(([a,l])=>{const r=m[a];return e.jsxs("div",{className:"continent-dropdown",children:[e.jsxs("div",{className:"continent-header",onClick:()=>s(a),children:[a," ",r?"▾":"▸"]}),r&&e.jsx("div",{className:"continent-shark-list",children:l.map(o=>e.jsx("div",{className:`shark-selector-item ${o.id===t?"selected":""}`,onClick:()=>h(o.id),children:(()=>{const d=N(o.countries.trim()),j=E(d);return e.jsxs(e.Fragment,{children:[j?e.jsxs("div",{className:"flag-and-code",children:[e.jsx("img",{src:`https://flagcdn.com/24x18/${j}.png`,alt:d,title:d,className:"flag-icon",loading:"lazy"}),e.jsx("span",{className:"country-code",children:j.toUpperCase()})]}):e.jsxs("span",{className:"flag-and-code",title:d,role:"img","aria-label":"unknown country",children:["🌍 ",e.jsx("span",{className:"country-code",children:"N/A"})]}),o.id]})})()},o.id))})]},a)})})]})]})}function T(){const[n,i]=x.useState(null),[h,t]=x.useState(!0),m=x.useRef(),u=x.useMemo(()=>I(),[]),g=D;x.useEffect(()=>{var c;if(n)(c=m.current)==null||c.highlightShark(n.id),t(!1);else{if(m.current){const s=m.current.getGlobe();b(s),v(s,u)}t(!0)}},[n]),x.useEffect(()=>{if(m.current){const c=m.current.getGlobe();b(c),v(c,u)}},[]);const p=c=>{if(typeof c=="object"&&c.lat!==void 0&&c.lng!==void 0){if(!h){console.log("Ignoring click because not all sharks are visible.");return}const{lat:s,lng:a}=c;console.log("Clicked at lat/lng:",s,a);const l=3,r=u.find(o=>{const d=Math.abs(o.lat-s),j=Math.abs(o.lng-a);return d<l&&j<l});if(r){const o=r.id.split("-")[0];console.log("Matched shark:",r.id," with ID: ",o);const d=g.find(j=>j.id==o)||null;console.log("Sending shark obect:",d),i(d)}else console.log("No nearby shark found."),i(null)}else{const s=g.find(a=>a.id==c)||null;i(s)}},f=()=>{i(null),t(!0)};return e.jsxs("div",{className:"page-content",children:[e.jsx("h1",{children:"GlobeViews Page"}),e.jsxs("div",{className:"globe-views-container",children:[e.jsx("div",{className:"info-sidebar",children:e.jsx(M,{shark:n})}),e.jsx("div",{className:"globe-container",children:e.jsx(A,{ref:m,onSharkClick:p,allowClicks:!n})}),e.jsx("div",{className:"shark-selector",children:e.jsx(U,{sharks:g,onSelect:p,onReset:f,selectedSharkId:n?n.id:null})})]})]})}export{T as default};
