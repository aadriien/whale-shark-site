import{r,R as x,e as N,j as e,p as C,g as y,m as v}from"./index-XN5wJbaP.js";import{g as w,c as S,a as j,G as A}from"./FavoriteButton-BDiq8ueZ.js";import{S as I,a as D}from"./SharkSelector-CoWnuAk6.js";import"./three.module-BY-9PNfi.js";import"./linear-BcwBMSNj.js";import"./OrbitControls-DpXFg4GH.js";const E=new Set(["Africa","Antarctica","Asia","Europe","North America","Oceania","South America"]);function R({sharks:o,onSelect:i,selectedSharkId:p}){const[u,l]=r.useState({}),d=x.useMemo(()=>{const s={};return o.forEach(a=>{N(a.continent).forEach(t=>{E.has(t)&&(s[t]||(s[t]=[]),s[t].push(a))})}),console.log("Sharks by continent:",Object.keys(s).map(a=>`${a}: ${s[a].length}`).join(", ")),s},[o]),m=s=>{l(a=>({...a,[s]:!a[s]}))};return e.jsx("div",{className:"scrollable-sharks-list",children:Object.keys(d).length===0?e.jsx("div",{className:"no-sharks-message",children:"Sorry! No whale sharks match your current filters."}):Object.entries(d).sort(([s],[a])=>s.localeCompare(a)).map(([s,a])=>{const n=u[s];return e.jsxs("div",{className:"continent-dropdown",children:[e.jsxs("div",{className:"continent-header",onClick:()=>m(s),children:[s," ",n?"▾":"▸"]}),n&&e.jsx("div",{className:"scrollable-shark-list",children:a.map(t=>e.jsx("div",{className:`shark-selector-item ${t.id===p?"selected":""}`,onClick:()=>i(t.id),children:(()=>{const c=C(t.countries.trim()),h=y(c);return e.jsxs(e.Fragment,{children:[h?e.jsxs("div",{className:"flag-and-code",children:[e.jsx("img",{src:`https://flagcdn.com/24x18/${h}.png`,alt:c,title:c,className:"flag-icon",loading:"lazy"}),e.jsx("span",{className:"country-code",children:h.toUpperCase()})]}):e.jsxs("span",{className:"flag-and-code",title:c,role:"img","aria-label":"unknown country",children:["🌍 ",e.jsx("span",{className:"country-code",children:"N/A"})]}),t.id]})})()},t.id))})]},s)})})}function P(){const[o,i]=r.useState(null),[p,u]=r.useState(!0),l=r.useRef(),d=r.useMemo(()=>w(),[]),m=v;r.useEffect(()=>{if(o){if(l.current){const n=l.current.getGlobe();S(n),l.current.highlightShark(o.id)}u(!1)}else{if(l.current){const n=l.current.getGlobe();S(n),j(n,d)}u(!0)}},[o]),r.useEffect(()=>{if(l.current){const n=l.current.getGlobe();S(n),j(n,d)}},[]);const s=n=>{if(typeof n=="object"&&n.lat!==void 0&&n.lng!==void 0){if(!p){console.log("Ignoring click because not all sharks are visible.");return}const{lat:t,lng:c}=n;console.log("Clicked at lat/lng:",t,c);const h=3,b=d.find(f=>{const g=Math.abs(f.lat-t),k=Math.abs(f.lng-c);return g<h&&k<h});if(b){const f=b.id.split("-")[0];console.log("Matched shark:",b.id," with ID: ",f);const g=m.find(k=>k.id==f)||null;console.log("Sending shark obect:",g),i(g)}else console.log("No nearby shark found."),i(null)}else{const t=m.find(c=>c.id==n)||null;i(t)}},a=()=>{i(null),u(!0)};return e.jsx("div",{className:"page-content globeviews-wrapper",children:e.jsxs("div",{className:"globe-views-container",children:[e.jsx("div",{className:"info-sidebar",children:e.jsx(I,{shark:o})}),e.jsx("div",{className:"globe-container",children:e.jsx(A,{ref:l,onSharkClick:s,allowClicks:!o})}),e.jsx("div",{className:"shark-selector",children:e.jsx(D,{sharks:m,onSelect:s,onReset:a,selectedSharkId:o?o.id:null,DisplayComponent:R})})]})})}export{P as default};
