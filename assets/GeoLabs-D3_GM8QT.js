import{r as o,j as e,a as G,b as E,c as F,m as A}from"./index-BW5BPaAh.js";import{b as L,F as R,d as B,c as S,a as y,G as U}from"./FavoriteButton-CW_N1ayD.js";import{P as W}from"./PlayStoryButton-CSf8tDLs.js";import{S as z,a as T}from"./SharkSelector-w6a2O7kW.js";import"./three.module-BTTigmqi.js";import"./linear-BcwBMSNj.js";import"./OrbitControls-C22u-Lz6.js";const $=({shark:t,onStepChange:r,currentStepIndex:i,isVisible:c})=>{const[d,m]=o.useState([]);if(o.useEffect(()=>{if(t){const l=L(t.id);m(l),c&&l.length===1&&r(0,l[0])}},[t,c,r]),!c||!t||d.length===0)return null;const g=l=>{const v=parseInt(l.target.value),a=d[v];r(v,a)},n=()=>{if(i>0){const l=i-1;r(l,d[l])}},h=()=>{if(i<d.length-1){const l=i+1;r(l,d[l])}},f=d[i];return e.jsx("div",{className:"story-step-container",children:e.jsxs("div",{className:"story-slider-section",children:[e.jsxs("h4",{children:["Point ",i+1," of ",d.length,f&&e.jsxs("span",{className:"step-date-header",children:[" ... ",f.date||"Unknown date"]})]}),e.jsxs("div",{className:"slider-controls",children:[e.jsx("button",{className:"step-button",onClick:n,disabled:i===0,children:"-"}),e.jsx("input",{type:"range",min:"0",max:d.length-1,value:i,onChange:g,className:"story-slider"}),e.jsx("button",{className:"step-button",onClick:h,disabled:i===d.length-1,children:"+"})]})]})})},V=({shark:t})=>{const r=t.image!=="Unknown"?G(t.image):[];return e.jsxs("div",{className:"shark-banner",children:[e.jsx("div",{className:"tiny-banner-media",children:r.length>0?e.jsx("img",{src:r[0].url,alt:`Image of shark ${t.id}`}):e.jsx("span",{className:"no-image",children:"N/A"})}),e.jsxs("div",{className:"tiny-id-row",children:[e.jsx("strong",{children:t.id}),e.jsx(R,{sharkId:t.id})]})]})};function q({sharks:t,onSelect:r,selectedSharkId:i}){const[c,d]=o.useState(new Set);o.useEffect(()=>{const n=()=>{d(E())};return n(),window.addEventListener("storage",n),window.addEventListener("favoritesChanged",n),()=>{window.removeEventListener("storage",n),window.removeEventListener("favoritesChanged",n)}},[]);const m=o.useMemo(()=>{if(c.size===0)return[];const n=new Map(t.map(h=>[h.id,h]));return[...c].map(h=>n.get(h)).filter(Boolean).sort((h,f)=>h.id.localeCompare(f.id))},[t,c]),g=n=>{r&&r(n.id)};return e.jsxs("div",{className:"saved-sharks-display",children:[e.jsx("div",{className:"saved-sharks-header",children:e.jsxs("h3",{children:["Saved Sharks (",m.length,")"]})}),m.length===0?e.jsxs("div",{className:"no-sharks-message",children:["Sorry! No whale sharks match your current filters.",e.jsx("br",{}),e.jsx("br",{}),"Use the ⭐ button to save sharks while browsing!"]}):e.jsx("div",{className:"scrollable-shark-list",children:e.jsx("div",{className:"saved-sharks-grid",children:m.map(n=>e.jsx("div",{className:`saved-shark-card-wrapper ${n.id===i?"selected":""}`,onClick:()=>g(n),children:e.jsx(V,{shark:n})},n.id))})})]})}function Z(){const[t,r]=o.useState(null),[i,c]=o.useState(!0),[d,m]=o.useState(new Set),[g,n]=o.useState(!1),[h,f]=o.useState(0),[l,v]=o.useState(null),a=o.useRef();o.useEffect(()=>{const s=()=>{m(E())};return s(),window.addEventListener("storage",s),window.addEventListener("favoritesChanged",s),()=>{window.removeEventListener("storage",s),window.removeEventListener("favoritesChanged",s)}},[]);const b=o.useMemo(()=>{const s=F();return console.log("Plotting saved sharks on globe:",s),B(s)},[d]),k=A;o.useEffect(()=>{if(t){if(a.current){const s=a.current.getGlobe();S(s),a.current.highlightShark(t.id,!0)}c(!1)}else{if(a.current){const s=a.current.getGlobe();S(s),y(s,b)}c(!0)}},[t,b]),o.useEffect(()=>{if(a.current&&!t){const s=a.current.getGlobe();S(s),y(s,b)}},[b]);const C=s=>{if(typeof s=="object"&&s.lat!==void 0&&s.lng!==void 0){if(!i){console.log("Ignoring click because not all sharks are visible.");return}const{lat:u,lng:p}=s;console.log("Clicked at lat/lng:",u,p);const I=3,w=b.find(x=>{const j=Math.abs(x.lat-u),N=Math.abs(x.lng-p);return j<I&&N<I});if(w){const x=w.id.split("-")[0];console.log("Matched shark:",w.id," with ID: ",x);const j=k.find(N=>N.id==x)||null;console.log("Sending shark obect:",j),r(j)}else console.log("No nearby shark found."),r(null)}else{const u=k.find(p=>p.id==s)||null;r(u)}},P=()=>{r(null),c(!0)},M=()=>{if(g){if(n(!1),f(0),v(null),a.current){const s=a.current.getGlobe();if(S(s),a.current.enableControls(),t){const u=L(t.id);y(s,u)}}}else if(n(!0),f(0),a.current){const s=a.current.getGlobe();S(s)}},D=o.useCallback((s,u)=>{f(s),v(u),a.current&&u&&a.current.showSinglePoint(u)},[]);return e.jsx("div",{className:"page-content globeviews-wrapper",children:e.jsxs("div",{className:"globe-views-container",children:[e.jsxs("div",{className:"info-sidebar",children:[t&&e.jsxs("div",{className:"story-controls-container",children:[e.jsx(W,{shark:t,onToggleStepMode:M,isStepMode:g,showPauseForGeoLabs:!0}),e.jsx($,{shark:t,onStepChange:D,currentStepIndex:h,isVisible:g})]}),e.jsx(z,{shark:t})]}),e.jsxs("div",{className:"globe-container",children:[e.jsx(U,{ref:a,onSharkClick:C,allowClicks:!t}),g&&l&&e.jsxs("div",{style:{position:"absolute",bottom:10,width:"100%",textAlign:"center",color:"white",fontSize:"0.85rem",fontFamily:"sans-serif",padding:"2px 0",backgroundColor:"rgba(0, 0, 0, 0)",textShadow:"0 0 8px rgba(0, 255, 255, 0.9)",pointerEvents:"none",userSelect:"none"},children:["Lat: ",e.jsx("span",{style:{fontWeight:"bold"},children:l.lat.toFixed(3)}),","," ","Lng: ",e.jsx("span",{style:{fontWeight:"bold"},children:l.lng.toFixed(3)})," —"," ","Date: ",e.jsx("span",{style:{fontWeight:"bold"},children:l.date||"N/A"})]})]}),e.jsx("div",{className:"shark-selector",children:e.jsx(T,{sharks:k,onSelect:C,onReset:P,selectedSharkId:t?t.id:null,DisplayComponent:q,disabled:g})})]})})}export{Z as default};
