import{r as c,j as t,a as Y,b as Q,R as X,c as U,p as E,d as Z,m as _}from"./index-BWEFf2V2.js";import{b as R,d as B,c as D,e as k,a as I,F as L,g as G,G as ee}from"./FavoriteButton-BYzLACYn.js";import{P as te}from"./PlayStoryButton-oqkbnSH-.js";import{u as ne,S as se,a as ae}from"./GlobeClick-De3gENcK.js";import{D as re,H as ie,C as le,S as oe}from"./SexLifeStageData-DabMyezt.js";import"./three.module-BTTigmqi.js";import"./linear-BcwBMSNj.js";import"./OrbitControls-C22u-Lz6.js";const ce=({shark:e,onStepChange:s,currentStepIndex:a,isVisible:o})=>{const[r,f]=c.useState([]);if(c.useEffect(()=>{if(e){const n=R(e.id);f(n),o&&n.length===1&&s(0,n[0])}},[e,o,s]),!o||!e||r.length===0)return null;const m=n=>{const S=parseInt(n.target.value),y=r[S];s(S,y)},d=()=>{if(a>0){const n=a-1;s(n,r[n])}},i=()=>{if(a<r.length-1){const n=a+1;s(n,r[n])}},u=r[a];return t.jsx("div",{className:"story-step-container",children:t.jsxs("div",{className:"story-slider-section",children:[t.jsxs("h4",{children:["Point ",a+1," of ",r.length,u&&t.jsxs("span",{className:"step-date-header",children:[" ... ",u.date||"Unknown date"]})]}),t.jsxs("div",{className:"slider-controls",children:[t.jsx("button",{className:"step-button",onClick:d,disabled:a===0,children:"-"}),t.jsx("input",{type:"range",min:"0",max:r.length-1,value:a,onChange:m,className:"story-slider"}),t.jsx("button",{className:"step-button",onClick:i,disabled:a===r.length-1,children:"+"})]})]})})},de=({onToggleTimelineMode:e,isTimelineMode:s=!1})=>t.jsx("div",{className:"timeline-mode-section",children:t.jsx("button",{className:`geo-labs-timeline-button
                    ${s?" timeline-mode-active":""}
                `,onClick:a=>{a.stopPropagation(),e()},children:s?"Exit Timeline Mode":t.jsxs(t.Fragment,{children:["Explore Shark Data ",t.jsx("strong",{children:"Timeline"})]})})}),ue=({onTimelineChange:e,currentMonth:s,currentYear:a,isVisible:o,availableSharks:r=[],plottedCoordinates:f=[]})=>{const m=()=>{const v=new Set;return B.forEach(x=>{(r.length===0||r.includes(x.whaleSharkID))&&x.coordinates.forEach(w=>{if(w.parsedDate){const M=new Date(w.parsedDate),P=M.getFullYear(),A=M.getMonth()+1;!isNaN(P)&&!isNaN(A)&&v.add(`${P}-${A.toString().padStart(2,"0")}`)}})}),Array.from(v).sort()},d=c.useMemo(()=>m(),[r]),i=()=>{if(d.length===0)return 0;const v=`${a||new Date().getFullYear()}-${(s||new Date().getMonth()+1).toString().padStart(2,"0")}`,x=d.indexOf(v);return x>=0?x:0},[u,n]=c.useState(i),S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h=(v=>{if(d.length===0)return{month:1,year:new Date().getFullYear()};const x=d[v]||d[0],[w,M]=x.split("-").map(Number);return{month:M,year:w}})(u),g=c.useMemo(()=>{if(!f||f.length===0)return[];const v=new Set;return f.forEach(x=>{if(x.id){const w=x.id.split("-")[0];v.add(w)}}),Array.from(v).sort((x,w)=>x.localeCompare(w))},[f]);if(c.useEffect(()=>{if(o&&d.length>0){const{month:v,year:x}=h;e(v,x)}},[u,o,e,d.length]),!o||d.length===0)return null;const j=v=>{const x=parseInt(v.target.value);n(x)},p=()=>{u>0&&n(u-1)},b=()=>{u<d.length-1&&n(u+1)},C=u>0,T=u<d.length-1;return t.jsx("div",{className:"timeline-selector-container",children:t.jsxs("div",{className:"timeline-controls",children:[t.jsxs("div",{className:"timeline-navigation",children:[t.jsx("button",{className:"timeline-nav-button",onClick:p,disabled:!C,title:"Previous month",children:"←"}),t.jsxs("div",{className:"timeline-date-display",children:[S[h.month-1]," ",h.year]}),t.jsx("button",{className:"timeline-nav-button",onClick:b,disabled:!T,title:"Next month",children:"→"})]}),t.jsx("div",{className:"timeline-slider-section",children:t.jsx("input",{type:"range",min:"0",max:d.length-1,value:u,onChange:j,className:"timeline-slider"})}),t.jsxs("div",{className:"timeline-info",children:["Showing map data from ",S[h.month-1]," ",h.year]}),g.length>0&&t.jsxs("div",{className:"timeline-sharks-display",children:[t.jsxs("div",{className:"sharks-list-title",children:["Plotting ",g.length," whale shark",g.length!==1?"s":"",":"]}),t.jsx("div",{className:"sharks-list",children:g.map(v=>t.jsx("span",{className:"timeline-shark-id",children:v},v))})]})]})})},he=({globeRef:e,selectedSharksForLab:s,onToggleTimelineMode:a,isTimelineMode:o,onTimelineStateChange:r})=>{const[f,m]=c.useState(null),[d,i]=c.useState(null),[u,n]=c.useState([]),S=()=>{o&&(m(null),i(null),n([])),a(),r==null||r(!1)},y=c.useCallback((g,j)=>{if(m(g),i(j),console.log(`Timeline changed to: ${g}/${j}`),e.current&&g&&j){const p=e.current.getGlobe();D(p);const b=Y();let C;s.size>0?C=k(Array.from(s),g,j):C=k(b,g,j),n(C),I(p,C)}},[e,s]),h=()=>s.size>0?Array.from(s):Y();return t.jsxs("div",{className:"timeline-controls-container",children:[t.jsx(de,{onToggleTimelineMode:S,isTimelineMode:o}),t.jsx(ue,{onTimelineChange:y,currentMonth:f,currentYear:d,isVisible:o,availableSharks:h(),plottedCoordinates:u})]})},me=({shark:e})=>{const s=e.image!=="Unknown"?Q(e.image):[];return t.jsxs("div",{className:"shark-banner",children:[t.jsx("div",{className:"tiny-banner-media",children:s.length>0?t.jsx("img",{src:s[0].url,alt:`Image of shark ${e.id}`}):t.jsx("span",{className:"no-image",children:"N/A"})}),t.jsxs("div",{className:"tiny-id-row",children:[t.jsx("strong",{children:e.id}),t.jsx(L,{sharkId:e.id})]})]})};function ge({sharks:e,onSelect:s,selectedSharkId:a,viewMode:o,selectedSharksForLab:r,onLabSelectionChange:f}){const[m,d]=c.useState(new Set),[i,u]=c.useState(!1);c.useEffect(()=>{const h=()=>{d(U()),u(!0)};return h(),window.addEventListener("storage",h),window.addEventListener("favoritesChanged",h),()=>{window.removeEventListener("storage",h),window.removeEventListener("favoritesChanged",h)}},[]);const n=c.useMemo(()=>{if(m.size===0)return[];const h=new Map(e.map(g=>[g.id,g]));return[...m].map(g=>h.get(g)).filter(Boolean).sort((g,j)=>g.id.localeCompare(j.id))},[e,m]),S=h=>{o==="multiple"?y(h.id):s&&s(h.id)},y=X.useCallback(h=>{if(f&&r){const g=new Set(r);g.has(h)?g.delete(h):g.add(h),f(g)}},[f,r]);return t.jsxs("div",{className:"saved-sharks-display",children:[t.jsx("div",{className:"saved-sharks-header",children:t.jsxs("h3",{children:["Saved Sharks (",n.length,")"]})}),n.length>0?t.jsx("div",{className:"scrollable-shark-list",children:t.jsx("div",{className:"saved-sharks-grid",children:n.map(h=>{const g=r&&r.has(h.id);return t.jsx("div",{className:`saved-shark-card-wrapper ${o==="individual"&&h.id===a?"selected":""} ${o==="multiple"&&g?"selected-for-lab":""}`,onClick:()=>S(h),children:t.jsx(me,{shark:h})},h.id)})})}):i&&m.size===0?t.jsxs("div",{className:"no-sharks-message",children:["Sorry! No whale sharks match your current filters.",t.jsx("br",{}),t.jsx("br",{}),"Use the ⭐ button to save sharks while browsing!"]}):null]})}function fe(e){if(e.country)return e.country;if(e.countries){const s=e.countries.split(",")[0];return E(s)}return e["country (year)"]?E(e["country (year)"]):"Unknown"}function pe(e){if(e.year)return e.year;if(e.newest)return new Date(e.newest).getFullYear();if(e["Newest Occurrence"])return new Date(e["Newest Occurrence"]).getFullYear();if(e.oldest)return new Date(e.oldest).getFullYear();if(e["Oldest Occurrence"])return new Date(e["Oldest Occurrence"]).getFullYear();if(e.countries){const s=Z(e.countries);if(s!=="Unknown"){const a=s.match(/(\d{4})/);if(a)return parseInt(a[1])}}return new Date().getFullYear()}function ve(e){if(e.publishing){const s=e.publishing.split(",")[0];return E(s)}return e["publishingCountry (year)"]?E(e["publishingCountry (year)"]):"Unknown"}function xe(e,s){if(!e||e.length===0)return[];const a=Array.isArray(e)?e:Array.from(e);if(a.length>0&&(typeof a[0]=="string"||typeof a[0]=="number")){const o=new Set(a.map(r=>String(r)));return s.filter(r=>o.has(String(r.whaleSharkID))||o.has(String(r.identificationID))||o.has(String(r.id)))}return a}function Se(e,s=[]){const a=xe(e,s);if(a.length===0)return[{Summary:"No sharks selected","Total Selected":0,"Total Occurrences":0,Countries:"N/A",Years:"N/A","Top 3 Publishing Countries":"N/A"}];const o=new Set,r=new Set,f=new Map;let m=0;a.forEach(n=>{o.add(fe(n)),r.add(pe(n));const S=parseInt(n["Total Occurrences"])||parseInt(n.occurrences)||parseInt(n.TotalOccurrences)||1;m+=S;const y=ve(n);y!=="Unknown"&&f.set(y,(f.get(y)||0)+1)});const d=Array.from(f.entries()).sort((n,S)=>S[1]-n[1]).slice(0,3).map(([n])=>n).join(" > "),i=Array.from(r),u=Array.from(o);return[{Summary:`${a.length} Selected Sharks`,"Total Selected":a.length,"Total Occurrences":m,Countries:u.slice(0,3).join(", ")+(u.length>3?"...":""),Years:i.length>0?`${Math.min(...i)} - ${Math.max(...i)}`:"N/A","Unique Countries":u.length,"Year Range":i.length>0?Math.max(...i)-Math.min(...i)+1:0,"Top 3 Publishing Countries":d||"Unknown"}]}function ye(e,s=[]){if(!e||e.length===0)return[];const a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=new Map;(Array.isArray(e)?e:Array.from(e)).forEach(m=>{const d=B.find(i=>i.whaleSharkID===m);d&&d.coordinates&&d.coordinates.forEach(i=>{if(i.eventDate){const u=new Date(i.eventDate);if(!isNaN(u.getTime())){const n=u.getFullYear(),S=a[u.getMonth()],y=`${n}-${S}`;o.set(y,(o.get(y)||0)+1)}}})});const f=[];for(const[m,d]of o.entries()){const[i,u]=m.split("-");f.push({year:parseInt(i),month:u,value:d})}return f}function je({selectedSharksForLab:e,savedIds:s,sharks:a,onSelectAllToggle:o}){const r=c.useMemo(()=>{if(e.size===0)return[];const d=Array.from(e),i=a.filter(u=>d.includes(u.id));return Se(i)},[e,a]),f=c.useMemo(()=>e.size===0?[]:ye(e),[e]),m=c.useMemo(()=>{if(e.size===0)return[];const d=Array.from(e);return a.filter(i=>d.includes(i.id))},[e,a]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"multi-select-info",children:[t.jsxs("div",{className:"multi-select-header",children:[t.jsxs("h4",{children:["Selected for Lab (",e.size,"):"]}),t.jsxs("label",{className:"select-all-container",children:[t.jsx("input",{type:"checkbox",checked:e.size>0&&Array.from(s).every(d=>e.has(d)),onChange:o,className:"select-all-checkbox"}),"Add all saved whale sharks"]})]}),t.jsx("div",{className:"selected-sharks-list",children:e.size>0?Array.from(e).join(", "):"None in lab"})]}),t.jsx("div",{className:"overview-container",children:t.jsx(re,{dataset:r,filterField:"Summary",selectedFilter:e.size>0?`${e.size} Selected Sharks`:"",displayFields:[{label:"Total Occurrences",field:"Total Occurrences"},{label:"Top 3 Publishing Countries",field:"Top 3 Publishing Countries"}]})}),t.jsx("div",{className:"heatmap-container",children:e.size>0&&f.length>0?t.jsx(ie,{data:f,title:"Lab Sharks Occurrence Timeline"}):t.jsx(le,{type:"heatmap",message:"Add sharks to lab for heatmap"})}),t.jsx("div",{className:"radial-heatmap-container",children:t.jsx(oe,{sharks:m})})]})}function Te(){const[e,s]=c.useState(null),[a,o]=c.useState(!0),[r,f]=c.useState(new Set),[m,d]=c.useState("multiple"),[i,u]=c.useState(new Set),[n,S]=c.useState(!1),[y,h]=c.useState(0),[g,j]=c.useState(null),p=c.useRef(),[b,C]=c.useState(!1),[T,v]=c.useState(null),[x,w]=c.useState(null);c.useEffect(()=>{const l=()=>{f(U())};return l(),window.addEventListener("storage",l),window.addEventListener("favoritesChanged",l),()=>{window.removeEventListener("storage",l),window.removeEventListener("favoritesChanged",l)}},[]);const M=c.useMemo(()=>{const l=Y();return console.log("Plotting saved sharks on globe:",l),G(l)},[r]),P=c.useMemo(()=>{if(i.size===0)return[];const l=Array.from(i);return console.log("Plotting selected lab sharks on globe:",l),b&&T&&x?k(l,T,x):G(l)},[i,b,T,x]),A=_;c.useEffect(()=>{if(!p.current)return;const l=p.current.getGlobe();if(D(l),n){o(!1);return}if(b){o(!1);return}m==="individual"?e?(p.current.highlightShark(e.id,!0),o(!1)):(I(l,M),o(!0)):i.size>0?(I(l,P),o(!0)):(I(l,M),o(!0))},[m,e,M,P,n]);const O=ne({sharks:A,pointsData:M,allSharksVisible:a,onSharkSelect:s}),J=()=>{s(null),o(!0)},H=()=>{if(n){if(S(!1),h(0),j(null),p.current){const l=p.current.getGlobe();if(D(l),p.current.enableControls(),e){const N=R(e.id);I(l,N)}}}else if(S(!0),h(0),p.current){const l=p.current.getGlobe();D(l)}},V=c.useCallback((l,N)=>{h(l),j(N),p.current&&N&&p.current.showSinglePoint(N)},[]),F=()=>{i.size>0&&Array.from(r).every(l=>i.has(l))?u(new Set):u(new Set(r))},W=()=>{if(s(null),u(new Set),o(!0),n&&(S(!1),h(0),j(null),p.current&&p.current.enableControls()),b&&(C(!1),v(null),w(null)),p.current){const l=p.current.getGlobe();D(l)}d(l=>l==="individual"?"multiple":"individual")},q=()=>{b?(C(!1),v(null),w(null)):C(!0)};return c.useCallback((l,N)=>{if(v(l),w(N),console.log(`Timeline changed to: ${l}/${N}`),p.current&&l&&N){const $=p.current.getGlobe();D($);const K=Y();let z;i.size>0?z=k(Array.from(i),l,N):z=k(K,l,N),I($,z)}},[i]),t.jsx("div",{className:"page-content globeviews-wrapper",children:t.jsxs("div",{className:"globe-views-container",children:[t.jsxs("div",{className:"info-sidebar",children:[t.jsx("button",{className:`view-mode-toggle ${m}`,onClick:W,children:m==="individual"?"Switch to Multi Shark View":"Switch to Single Shark View"}),e&&t.jsxs("div",{className:"story-controls-container",children:[t.jsx(te,{shark:e,onToggleStepMode:H,isStepMode:n,showPauseForGeoLabs:!0}),t.jsx(ce,{shark:e,onStepChange:V,currentStepIndex:y,isVisible:n})]}),m==="multiple"&&t.jsx(he,{globeRef:p,selectedSharksForLab:i,onToggleTimelineMode:q,isTimelineMode:b}),m==="multiple"?t.jsx("div",{className:"shark-info-panel",children:t.jsx(je,{selectedSharksForLab:i,savedIds:r,sharks:A,onSelectAllToggle:F})}):t.jsx(se,{shark:e})]}),t.jsxs("div",{className:"globe-container",children:[t.jsx(ee,{ref:p,onSharkClick:O,allowClicks:m==="individual"&&!e}),n&&g&&t.jsxs("div",{style:{position:"absolute",bottom:10,width:"100%",textAlign:"center",color:"white",fontSize:"0.85rem",fontFamily:"sans-serif",padding:"2px 0",backgroundColor:"rgba(0, 0, 0, 0)",textShadow:"0 0 8px rgba(0, 255, 255, 0.9)",pointerEvents:"none",userSelect:"none"},children:["Lat: ",t.jsx("span",{style:{fontWeight:"bold"},children:g.lat.toFixed(3)}),","," ","Lng: ",t.jsx("span",{style:{fontWeight:"bold"},children:g.lng.toFixed(3)})," —"," ","Date: ",t.jsx("span",{style:{fontWeight:"bold"},children:g.date||"N/A"})]})]}),t.jsx("div",{className:"shark-selector",children:t.jsx(ae,{sharks:A,onSelect:O,onReset:J,selectedSharkId:e?e.id:null,DisplayComponent:l=>t.jsx(ge,{...l,viewMode:m,selectedSharksForLab:i,onLabSelectionChange:u,onSelect:m==="multiple"?null:l.onSelect}),disabled:n||b})})]})})}export{Te as default};
