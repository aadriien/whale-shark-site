import{r as t,a as N,j as e,i as I,t as C,b as x,c as E,m as L}from"./index-C72PlvvJ.js";import{b as y,c as b,a as w,G as D}from"./Globe-B0V-b_q-.js";import{S as G,a as M}from"./SharkSelector-CIzi-cAH.js";import"./three.module-BY-9PNfi.js";import"./linear-BcwBMSNj.js";import"./OrbitControls-DpXFg4GH.js";const R=({shark:n})=>{const[l,d]=t.useState({}),r=n.image!=="Unknown"?N(n.image):[];return e.jsxs("div",{className:"shark-banner",children:[e.jsx("div",{className:"tiny-banner-media",children:r.length>0?e.jsx("img",{src:r[0].url,alt:`Image of shark ${n.id}`}):e.jsx("span",{className:"no-image",children:"N/A"})}),e.jsxs("div",{className:"tiny-id-row",children:[e.jsx("strong",{children:n.id}),e.jsx("button",{className:"favorite-button",onClick:c=>{c.stopPropagation(),C(n.id),d({})},children:I(n.id)?"★":"☆"})]})]})};function F({sharks:n,onSelect:l,selectedSharkId:d}){const[r,c]=t.useState(new Set);t.useEffect(()=>{const a=()=>{c(x())};return a(),window.addEventListener("storage",a),window.addEventListener("favoritesChanged",a),()=>{window.removeEventListener("storage",a),window.removeEventListener("favoritesChanged",a)}},[]);const h=t.useMemo(()=>{if(r.size===0)return[];const a=new Map(n.map(i=>[i.id,i]));return[...r].map(i=>a.get(i)).filter(Boolean).sort((i,v)=>i.id.localeCompare(v.id))},[n,r]),o=a=>{l&&l(a.id)};return e.jsxs("div",{className:"saved-sharks-display",children:[e.jsx("div",{className:"saved-sharks-header",children:e.jsxs("h3",{children:["Saved Sharks (",h.length,")"]})}),h.length===0?e.jsxs("div",{className:"no-sharks-message",children:["Sorry! No whale sharks match your current filters.",e.jsx("br",{}),e.jsx("br",{}),"Use the ⭐ button to save sharks while browsing!"]}):e.jsx("div",{className:"scrollable-shark-list",children:e.jsx("div",{className:"saved-sharks-grid",children:h.map(a=>e.jsx("div",{className:`saved-shark-card-wrapper ${a.id===d?"selected":""}`,onClick:()=>o(a),children:e.jsx(R,{shark:a})},a.id))})})]})}function z(){const[n,l]=t.useState(null),[d,r]=t.useState(!0),[c,h]=t.useState(new Set),o=t.useRef();t.useEffect(()=>{const s=()=>{h(x())};return s(),window.addEventListener("storage",s),window.addEventListener("favoritesChanged",s),()=>{window.removeEventListener("storage",s),window.removeEventListener("favoritesChanged",s)}},[]);const a=t.useMemo(()=>{const s=E();return console.log("Plotting saved sharks on globe:",s),y(s)},[c]),i=L;t.useEffect(()=>{if(n){if(o.current){const s=o.current.getGlobe();b(s),o.current.highlightShark(n.id)}r(!1)}else{if(o.current){const s=o.current.getGlobe();b(s),w(s,a)}r(!0)}},[n,a]),t.useEffect(()=>{if(o.current&&!n){const s=o.current.getGlobe();b(s),w(s,a)}},[a]);const v=s=>{if(typeof s=="object"&&s.lat!==void 0&&s.lng!==void 0){if(!d){console.log("Ignoring click because not all sharks are visible.");return}const{lat:g,lng:m}=s;console.log("Clicked at lat/lng:",g,m);const p=3,S=a.find(u=>{const f=Math.abs(u.lat-g),k=Math.abs(u.lng-m);return f<p&&k<p});if(S){const u=S.id.split("-")[0];console.log("Matched shark:",S.id," with ID: ",u);const f=i.find(k=>k.id==u)||null;console.log("Sending shark obect:",f),l(f)}else console.log("No nearby shark found."),l(null)}else{const g=i.find(m=>m.id==s)||null;l(g)}},j=()=>{l(null),r(!0)};return e.jsx("div",{className:"page-content globeviews-wrapper",children:e.jsxs("div",{className:"globe-views-container",children:[e.jsx("div",{className:"info-sidebar",children:e.jsx(G,{shark:n})}),e.jsx("div",{className:"globe-container",children:e.jsx(D,{ref:o,onSharkClick:v,allowClicks:!n})}),e.jsx("div",{className:"shark-selector",children:e.jsx(M,{sharks:i,onSelect:v,onReset:j,selectedSharkId:n?n.id:null,DisplayComponent:F})})]})})}export{z as default};
