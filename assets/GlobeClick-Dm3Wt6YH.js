import{r as h,d as I,j as e,h as k,p as S,i as F,F as U}from"./index-_eeLRr-Q.js";import{F as E}from"./FavoriteButton-CRepfWGC.js";import{C as A}from"./ChartPlaceholder-BKzLtkh8.js";import{e as w,f as L}from"./FilterSharks-BIgq0YVg.js";const O=({shark:s})=>{const[l,t]=h.useState(null),r=s&&s.image!=="Unknown"?I(s.image):[],i=a=>t(a),n=()=>t(null);return h.useEffect(()=>{if(l===null)return;const a=c=>{c.key==="ArrowLeft"?t(u=>Math.max(u-1,0)):c.key==="ArrowRight"?t(u=>Math.min(u+1,r.length-1)):c.key==="Escape"&&n()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[l,r.length]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"shark-images-container",children:[e.jsx("h3",{children:"Media Gallery"}),r.length>0?r.map((a,c)=>e.jsxs("div",{className:"shark-image-card",children:[e.jsx("img",{src:a.url,alt:`Shark image ${c}`,onClick:()=>i(c),style:{cursor:"pointer"}}),e.jsx("p",{className:"shark-image-meta",children:e.jsxs("small",{children:["ðŸ“¸ Creator: ",a.creator," | ",a.license]})})]},c)):e.jsx("p",{children:"No media available."})]}),l!==null&&e.jsx("div",{className:"image-overlay",onClick:n,children:e.jsxs("div",{className:"overlay-content",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{className:"carousel-button left",onClick:()=>t(a=>Math.max(a-1,0)),disabled:l===0,children:"< "}),e.jsxs("div",{className:"overlay-image-wrapper",children:[e.jsx("img",{src:r[l].url,alt:`Expanded shark image ${l}`}),e.jsxs("p",{className:"overlay-meta",children:["ðŸ“¸ Creator: ",r[l].creator," | ",r[l].license]})]}),e.jsx("button",{className:"carousel-button right",onClick:()=>t(a=>Math.min(a+1,r.length-1)),disabled:l===r.length-1,children:"> "}),e.jsx("button",{className:"close-button",onClick:n,children:"X"})]})})]})},V=({shark:s})=>{if(!s)return e.jsxs("div",{className:"shark-info-panel",children:[e.jsx("h2",{children:"Select a whale shark to view its records"}),e.jsx(A,{type:"globeViews",message:""})]});const l=s.countries.split(",").map(n=>n.trim()),t=s.regions?s.regions.split(",").map(n=>n.trim()):[],r=s.publishing?s.publishing.split(",").map(n=>n.trim()):[],i=s.remarks||"";return e.jsxs("div",{className:"shark-info-panel",children:[e.jsxs("h2",{children:["ID: ",s.id,e.jsx(E,{sharkId:s.id})]}),e.jsxs("div",{className:"shark-panel-details",children:[e.jsxs("div",{className:"shark-traits",children:[e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Sex:"}),"Â  ",s.sex]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Life Stage:"}),"Â  ",s.lifeStage]})]}),e.jsxs("div",{className:"shark-records",children:[e.jsxs("h3",{className:"shark-details",children:[e.jsx("strong",{children:"Total Records:"}),"Â  ",s.occurrences]}),e.jsxs("p",{className:"shark-details",children:[s.oldest," Â ...Â  ",s.newest]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Satellite tracking:"}),"Â Â ",Math.round(s.machine/(s.machine+s.human)*100),"%"]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Human sightings:"}),"Â Â ",Math.round(s.human/(s.machine+s.human)*100),"%"]})]}),e.jsxs("div",{className:"shark-regions",children:[e.jsx("h3",{className:"shark-details",children:"Places Visited"}),e.jsx("ul",{className:"timeline-list",children:l.map((n,a)=>{const c=t[a]||"Unknown",u=r[a]||"Unspecified",d=i||"None",m=k(c),x=k(n),g=m!=="Unknown"?m:x;return e.jsxs("li",{className:"timeline-item",children:[e.jsxs("div",{className:"timeline-header",children:[e.jsx("strong",{children:S(n)})," ",e.jsxs("span",{className:"timeline-date",children:["(",g,")"]})]}),e.jsxs("div",{className:"timeline-region",children:[e.jsx("span",{className:"timeline-label",children:"Region:"})," ",e.jsx("em",{children:c!=="Unknown"?S(c):"Unspecified"})]}),e.jsxs("div",{className:"timeline-meta",children:[e.jsx("span",{className:"timeline-label",children:"Published by:"})," ",e.jsx("em",{children:u!=="Unknown"?u:"Unspecified"})]}),e.jsxs("div",{className:"timeline-remarks",children:[e.jsx("span",{className:"timeline-label",children:"Sighting remarks:"})," ",e.jsx("em",{children:d!=="Unknown"?F(d):"None"})]})]},a)})})]}),e.jsx(O,{shark:s})]})]})};function D({criteria:s,onChange:l}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Media"}),e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.showOnlyWithMedia,onChange:()=>l({...s,showOnlyWithMedia:!s.showOnlyWithMedia})}),"Sharks with real-world images"]})]})}function T({criteria:s,onChange:l,countries:t,publishingCountries:r}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Location"}),e.jsxs("label",{className:"filter-label",children:["Country:",e.jsxs("select",{value:s.country,onChange:i=>l({...s,country:i.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),t.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("label",{className:"filter-label",children:["Publishing Country:",e.jsxs("select",{value:s.publishingCountry,onChange:i=>l({...s,publishingCountry:i.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),r.map(i=>e.jsx("option",{value:i,children:i},i))]})]})]})}function B({criteria:s,onChange:l,minYear:t,maxYear:r,months:i}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Time"}),e.jsxs("label",{className:"filter-label",children:["Year Range:",e.jsxs("div",{className:"range-inputs",children:[e.jsx("input",{type:"number",value:s.yearRange[0],onChange:n=>{const a=n.target.value;l({...s,yearRange:[a,s.yearRange[1]]})},onBlur:()=>{const n=parseInt(s.yearRange[0]),a=isNaN(n)?t:Math.max(t,Math.min(n,parseInt(s.yearRange[1])));l({...s,yearRange:[String(a),s.yearRange[1]]})},className:"filter-input"}),e.jsx("span",{style:{margin:"0 0.25rem"},children:"to"}),e.jsx("input",{type:"number",value:s.yearRange[1],onChange:n=>{const a=n.target.value;l({...s,yearRange:[s.yearRange[0],a]})},onBlur:()=>{const n=parseInt(s.yearRange[1]),a=isNaN(n)?r:Math.min(r,Math.max(n,parseInt(s.yearRange[0])));l({...s,yearRange:[s.yearRange[0],String(a)]})},className:"filter-input"})]})]}),e.jsxs("label",{className:"filter-label",children:["Month:",e.jsxs("select",{value:s.month,onChange:n=>l({...s,month:n.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),i.map(n=>e.jsx("option",{value:n,children:n},n))]})]})]})}function P({criteria:s,onChange:l,minRecords:t,maxRecords:r}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Metadata"}),e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.hasOccurrenceNotes,onChange:()=>l({...s,hasOccurrenceNotes:!s.hasOccurrenceNotes})}),"Sharks with occurrence notes"]}),e.jsxs("label",{className:"filter-label",children:["Min Records:",e.jsx("input",{type:"number",min:t,max:r,value:s.minRecords,onChange:i=>{const n=i.target.value;l({...s,minRecords:Number(n)})},onBlur:()=>{const i=s.minRecords;if(isNaN(i)){l({...s,minRecords:t});return}const n=Math.max(t,Math.min(i,r));l({...s,minRecords:n})},className:"filter-input"})]})]})}function $({criteria:s,onChange:l}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Biological"}),e.jsxs("label",{className:"filter-label",children:["Sex:",e.jsxs("select",{value:s.sex,onChange:t=>l({...s,sex:t.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"filter-label",children:["Life Stage:",e.jsxs("select",{value:s.lifeStage,onChange:t=>l({...s,lifeStage:t.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Juvenile",children:"Juvenile"}),e.jsx("option",{value:"Subadult",children:"Subadult"}),e.jsx("option",{value:"Adult",children:"Adult"}),e.jsx("option",{value:"Unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"filter-label",children:["Observation Type:",e.jsxs("select",{value:s.observationType,onChange:t=>l({...s,observationType:t.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Satellite",children:"Satellite Tracking"}),e.jsx("option",{value:"Human",children:"Human Sightings"})]})]})]})}function H({criteria:s,onChange:l,options:t}){const{countries:r=[],publishingCountries:i=[],minYear:n=2e3,maxYear:a=2024,months:c=[],minRecords:u=1,maxRecords:d=100}=t;return e.jsxs("div",{className:"shark-filters scrollable-filters",children:[e.jsx(D,{criteria:s,onChange:l}),e.jsx(T,{criteria:s,onChange:l,countries:r,publishingCountries:i}),e.jsx(B,{criteria:s,onChange:l,minYear:n,maxYear:a,months:c}),e.jsx(P,{criteria:s,onChange:l,minRecords:u,maxRecords:d}),e.jsx($,{criteria:s,onChange:l})]})}function q({sharks:s,onReset:l,onSelect:t,selectedSharkId:r,DisplayComponent:i,disabled:n=!1,onFilteredSharksChange:a}){const c=w(s,"countries"),u=w(s,"publishing"),d=Math.min(...s.map(o=>o.occurrences||1)),m=Math.max(...s.map(o=>o.occurrences||1)),x=s.flatMap(o=>[parseInt(o.oldest),parseInt(o.newest)]).filter(o=>!isNaN(o)),g=Math.min(...x),p=Math.max(...x),f=U,v=h.useMemo(()=>({country:"",publishingCountry:"",yearRange:[String(g),String(p)],month:"",sex:"",lifeStage:"",minRecords:1,observationType:"",showOnlyWithMedia:!1,hasOccurrenceNotes:!1}),[g,p]),[j,y]=h.useState(v),[N,R]=h.useState(!0),M=()=>{y(v),l&&l()},b=h.useMemo(()=>{console.log("Computing filteredSharks with criteria:",j);const o=L(s,j);return console.log(`filterSharks result: ${o.length}/${s.length} sharks`),o},[s,j]);h.useEffect(()=>{a&&a(b)},[b,a]);const C={countries:c,publishingCountries:u,minYear:g,maxYear:p,months:f,minRecords:d,maxRecords:m};return e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%",opacity:n?.6:1,pointerEvents:n?"none":"auto"},children:e.jsxs("div",{className:"shark-selector-list",children:[e.jsx("button",{onClick:M,className:`show-all-button ${r==null?"active":""}`,disabled:n,children:"Show All Sharks"}),e.jsxs("div",{className:"filter-toggle-container",children:[e.jsx("button",{onClick:()=>R(o=>!o),className:`toggle-filter-button ${N?"active":""}`,disabled:n,children:N?"Hide Filters â–²":"Show Filters â–¼"}),N&&e.jsx(H,{criteria:j,onChange:y,options:C})]}),e.jsx(i,{sharks:b,onSelect:t,selectedSharkId:r})]})})}function K({sharks:s,pointsData:l,allSharksVisible:t,onSharkSelect:r}){const i=h.useRef(s),n=h.useRef(l),a=h.useRef(t),c=h.useRef(r);return h.useEffect(()=>{i.current=s,n.current=l,a.current=t,c.current=r}),d=>{if(typeof d=="object"&&d.lat!==void 0&&d.lng!==void 0){if(!a.current){console.log("Ignoring click because not all sharks are visible.");return}const{lat:m,lng:x}=d;console.log("Clicked at lat/lng:",m,x);const g=3,p=n.current.find(f=>{const v=Math.abs(f.lat-m),j=Math.abs(f.lng-x);return v<g&&j<g});if(p){const f=p.id.split("-")[0];console.log("Matched shark:",p.id," with ID: ",f);const v=i.current.find(j=>j.id==f)||null;console.log("Sending shark object:",v),c.current(v)}else console.log("No nearby shark found."),c.current(null)}else{const m=i.current.find(x=>x.id==d)||null;c.current(m)}}}export{V as S,q as a,K as u};
