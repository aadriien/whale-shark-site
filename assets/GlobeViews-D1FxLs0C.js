import{r as p,p as B,j as e,i as G,t as P,g as L,a as y,b as T,R as I,e as F,c as H,d as $,m as V}from"./index-CPwtJut2.js";import{g as W,c as E,a as O,G as _}from"./Globe-TRbOIUvQ.js";import"./three.module-BY-9PNfi.js";import"./linear-BcwBMSNj.js";import"./OrbitControls-DpXFg4GH.js";const J=({shark:n})=>{const[a,l]=p.useState({}),[i,s]=p.useState(null),t=n&&n.image!=="Unknown"?B(n.image):[],c=r=>s(r),m=()=>s(null);if(p.useEffect(()=>{if(i===null)return;const r=d=>{d.key==="ArrowLeft"?s(h=>Math.max(h-1,0)):d.key==="ArrowRight"?s(h=>Math.min(h+1,t.length-1)):d.key==="Escape"&&m()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[i,t.length]),!n)return e.jsxs("div",{className:"shark-info-panel",children:[e.jsx("h2",{children:"All Sharks Overview"}),e.jsx("p",{children:"Select a shark to view detailed tracking information."})]});const b=n.countries.split(",").map(r=>r.trim()),u=n.regions?n.regions.split(",").map(r=>r.trim()):[],g=n.publishing?n.publishing.split(",").map(r=>r.trim()):[],f=n.remarks?n.remarks.split(",").map(r=>r.trim()):[];return e.jsxs("div",{className:"shark-info-panel",children:[e.jsxs("h2",{children:["ID: ",n.id,e.jsx("button",{className:"favorite-button",onClick:r=>{r.stopPropagation(),P(n.id),l({})},children:G(n.id)?"â˜…":"â˜†"})]}),e.jsxs("div",{className:"shark-panel-details",children:[e.jsxs("div",{className:"shark-traits",children:[e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Sex:"}),"Â  ",n.sex]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Life Stage:"}),"Â  ",n.lifeStage]})]}),e.jsxs("div",{className:"shark-records",children:[e.jsxs("h3",{className:"shark-details",children:[e.jsx("strong",{children:"Total Records:"}),"Â  ",n.occurrences]}),e.jsxs("p",{className:"shark-details",children:[n.oldest," Â ...Â  ",n.newest]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Satellite tracking:"}),"Â Â ",Math.round(n.machine/(n.machine+n.human)*100),"%"]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Human sightings:"}),"Â Â ",Math.round(n.human/(n.machine+n.human)*100),"%"]})]}),e.jsxs("div",{className:"shark-regions",children:[e.jsx("h3",{className:"shark-details",children:"Places Visited"}),e.jsx("ul",{className:"timeline-list",children:b.map((r,d)=>{const h=u[d]||"Unknown",x=g[d]||"Unspecified",v=f[d]||"None",S=L(h),w=L(r),C=S!=="Unknown"?S:w;return e.jsxs("li",{className:"timeline-item",children:[e.jsxs("div",{className:"timeline-header",children:[e.jsx("strong",{children:y(r)})," ",e.jsxs("span",{className:"timeline-date",children:["(",C,")"]})]}),e.jsxs("div",{className:"timeline-region",children:[e.jsx("span",{className:"timeline-label",children:"Region:"})," ",e.jsx("em",{children:h!=="Unknown"?y(h):"Unspecified"})]}),e.jsxs("div",{className:"timeline-meta",children:[e.jsx("span",{className:"timeline-label",children:"Published by:"})," ",e.jsx("em",{children:x!=="Unknown"?x:"Unspecified"})]}),e.jsxs("div",{className:"timeline-remarks",children:[e.jsx("span",{className:"timeline-label",children:"Sighting remarks:"})," ",e.jsx("em",{children:v!=="Unknown"?T(v):"None"})]})]},d)})})]}),e.jsxs("div",{className:"shark-images-container",children:[e.jsx("h3",{children:"Media Gallery"}),t.length>0?t.map((r,d)=>e.jsxs("div",{className:"shark-image-card",children:[e.jsx("img",{src:r.url,alt:`Shark image ${d}`,onClick:()=>c(d),style:{cursor:"pointer"}}),e.jsx("p",{className:"shark-image-meta",children:e.jsxs("small",{children:["ðŸ“¸ Creator: ",r.creator," | ",r.license]})})]},d)):e.jsx("p",{children:"No media available."})]})]}),i!==null&&e.jsx("div",{className:"image-overlay",onClick:m,children:e.jsxs("div",{className:"overlay-content",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{className:"carousel-button left",onClick:()=>s(r=>Math.max(r-1,0)),disabled:i===0,children:"< "}),e.jsxs("div",{className:"overlay-image-wrapper",children:[e.jsx("img",{src:t[i].url,alt:`Expanded shark image ${i}`}),e.jsxs("p",{className:"overlay-meta",children:["ðŸ“¸ Creator: ",t[i].creator," | ",t[i].license]})]}),e.jsx("button",{className:"carousel-button right",onClick:()=>s(r=>Math.min(r+1,t.length-1)),disabled:i===t.length-1,children:"> "}),e.jsx("button",{className:"close-button",onClick:m,children:"X"})]})})]})},Y=new Set(["Africa","Antarctica","Asia","Europe","North America","Oceania","South America"]);function U(n,a){return Array.from(new Set(n.flatMap(l=>{var i;return((i=l[a])==null?void 0:i.split(",").map(s=>y(s).trim()).filter(Boolean))||[]}))).sort((l,i)=>l.localeCompare(i))}function q(n,a){return n.filter(l=>{var i;if(a.showOnlyWithMedia&&!(l.image&&l.image.trim()!==""&&l.image!=="Unknown")||a.country&&!(l.countries||"").split(",").map(c=>y(c).toLowerCase().trim()).some(c=>c.includes(a.country.toLowerCase()))||a.publishingCountry&&!(l.publishing||"").split(",").map(c=>y(c).toLowerCase().trim()).some(c=>c.includes(a.publishingCountry.toLowerCase())))return!1;if(a.yearRange){const s=parseInt(l.oldest),t=parseInt(l.newest),c=parseInt(a.yearRange[0]),m=parseInt(a.yearRange[1]);if(isNaN(s)||isNaN(t)||t<c||s>m)return!1}if(a.hasOccurrenceNotes&&T(l.remarks)==="None"||a.minRecords>0&&l.occurrences<a.minRecords||a.sex&&(((i=l.sex)==null?void 0:i.toLowerCase())||"")!==a.sex.toLowerCase()||a.lifeStage&&$(l).toLowerCase()!==a.lifeStage.toLowerCase())return!1;if(a.observationType){let s=!0;if(a.observationType=="Satellite"?s=l.machine>0:a.observationType=="Human"&&(s=l.human>0),!s)return!1}return!0})}function z({filters:n,setFilters:a}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Media"}),e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:n.showOnlyWithMedia,onChange:()=>a(l=>({...l,showOnlyWithMedia:!l.showOnlyWithMedia}))}),"Sharks with real-world images"]})]})}function K({filters:n,setFilters:a,COUNTRIES:l,PUBLISHING_COUNTRIES:i}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Location"}),e.jsxs("label",{className:"filter-label",children:["Country:",e.jsxs("select",{value:n.country,onChange:s=>a(t=>({...t,country:s.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),l.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("label",{className:"filter-label",children:["Publishing Country:",e.jsxs("select",{value:n.publishingCountry,onChange:s=>a(t=>({...t,publishingCountry:s.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),i.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})}function X({filters:n,setFilters:a,MIN_YEAR:l,MAX_YEAR:i}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Time"}),e.jsxs("label",{className:"filter-label",children:["Year Range:",e.jsxs("div",{className:"range-inputs",children:[e.jsx("input",{type:"number",value:n.yearRange[0],onChange:s=>{const t=s.target.value;a(c=>({...c,yearRange:[t,c.yearRange[1]]}))},onBlur:()=>{a(s=>{const t=parseInt(s.yearRange[0]),c=isNaN(t)?l:Math.max(l,Math.min(t,parseInt(s.yearRange[1])));return{...s,yearRange:[String(c),s.yearRange[1]]}})},className:"filter-input"}),e.jsx("span",{style:{margin:"0 0.25rem"},children:"to"}),e.jsx("input",{type:"number",value:n.yearRange[1],onChange:s=>{const t=s.target.value;a(c=>({...c,yearRange:[c.yearRange[0],t]}))},onBlur:()=>{a(s=>{const t=parseInt(s.yearRange[1]),c=isNaN(t)?i:Math.min(i,Math.max(t,parseInt(s.yearRange[0])));return{...s,yearRange:[s.yearRange[0],String(c)]}})},className:"filter-input"})]})]})]})}function Q({filters:n,setFilters:a,MIN_RECORDS:l,MAX_RECORDS:i}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Metadata"}),e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:n.hasOccurrenceNotes,onChange:()=>a(s=>({...s,hasOccurrenceNotes:!s.hasOccurrenceNotes}))}),"Sharks with occurrence notes"]}),e.jsxs("label",{className:"filter-label",children:["Min Records:",e.jsx("input",{type:"number",min:l,max:i,value:n.minRecords,onChange:s=>{const t=s.target.value;a(c=>({...c,minRecords:t}))},onBlur:()=>{a(s=>{const t=parseInt(s.minRecords,10);if(isNaN(t))return{...s,minRecords:l};const c=Math.max(l,Math.min(t,i));return{...s,minRecords:c}})},className:"filter-input"})]})]})}function Z({filters:n,setFilters:a}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Biological"}),e.jsxs("label",{className:"filter-label",children:["Sex:",e.jsxs("select",{value:n.sex,onChange:l=>a(i=>({...i,sex:l.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"filter-label",children:["Life Stage:",e.jsxs("select",{value:n.lifeStage,onChange:l=>a(i=>({...i,lifeStage:l.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Juvenile",children:"Juvenile"}),e.jsx("option",{value:"Subadult",children:"Subadult"}),e.jsx("option",{value:"Adult",children:"Adult"}),e.jsx("option",{value:"Unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"filter-label",children:["Observation Type:",e.jsxs("select",{value:n.observationType,onChange:l=>a(i=>({...i,observationType:l.target.value})),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Satellite",children:"Satellite Tracking"}),e.jsx("option",{value:"Human",children:"Human Sightings"})]})]})]})}function ee({filters:n,setFilters:a,COUNTRIES:l,PUBLISHING_COUNTRIES:i,MIN_YEAR:s,MAX_YEAR:t,MIN_RECORDS:c,MAX_RECORDS:m}){return e.jsxs("div",{className:"shark-filters scrollable-filters",children:[z({filters:n,setFilters:a}),K({filters:n,setFilters:a,COUNTRIES:l,PUBLISHING_COUNTRIES:i}),X({filters:n,setFilters:a,MIN_YEAR:s,MAX_YEAR:t}),Q({filters:n,setFilters:a,MIN_RECORDS:c,MAX_RECORDS:m}),Z({filters:n,setFilters:a})]})}function se({sharks:n,onReset:a,onSelect:l,selectedSharkId:i}){const s=U(n,"countries"),t=U(n,"publishing"),c=Math.min(...n.map(o=>o.occurrences||1)),m=Math.max(...n.map(o=>o.occurrences||1)),b=n.flatMap(o=>[parseInt(o.oldest),parseInt(o.newest)]).filter(o=>!isNaN(o)),u=Math.min(...b),g=Math.max(...b),f={showOnlyWithMedia:!1,country:"",yearRange:[String(u),String(g)],hasOccurrenceNotes:!1,minRecords:1,sex:"",lifeStage:"",publishingCountry:"",observationType:""},[r,d]=I.useState(f),[h,x]=p.useState(!0),v=()=>{d(f),x(!1),w({}),a&&a()},[S,w]=p.useState({}),C=I.useMemo(()=>q(n,r),[n,r]),A=I.useMemo(()=>{const o={};return C.forEach(N=>{F(N.continent).forEach(j=>{Y.has(j)&&(o[j]||(o[j]=[]),o[j].push(N))})}),o},[C]),D=o=>{w(N=>({...N,[o]:!N[o]}))};return e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs("div",{className:"shark-selector-list",children:[e.jsx("button",{onClick:v,className:`show-all-button ${i==null?"active":""}`,children:"Show All Sharks"}),e.jsxs("div",{className:"filter-toggle-container",children:[e.jsx("button",{onClick:()=>x(o=>!o),className:`toggle-filter-button ${h?"active":""}`,children:h?"Hide Filters â–²":"Show Filters â–¼"}),h&&ee({filters:r,setFilters:d,COUNTRIES:s,PUBLISHING_COUNTRIES:t,MIN_YEAR:u,MAX_YEAR:g,MIN_RECORDS:c,MAX_RECORDS:m})]}),e.jsx("div",{className:"scrollable-sharks-list",children:Object.keys(A).length===0?e.jsx("div",{className:"no-sharks-message",children:"Sorry! No whale sharks match your current filters."}):Object.entries(A).sort(([o],[N])=>o.localeCompare(N)).map(([o,N])=>{const R=S[o];return e.jsxs("div",{className:"continent-dropdown",children:[e.jsxs("div",{className:"continent-header",onClick:()=>D(o),children:[o," ",R?"â–¾":"â–¸"]}),R&&e.jsx("div",{className:"continent-shark-list",children:N.map(j=>e.jsx("div",{className:`shark-selector-item ${j.id===i?"selected":""}`,onClick:()=>l(j.id),children:(()=>{const k=y(j.countries.trim()),M=H(k);return e.jsxs(e.Fragment,{children:[M?e.jsxs("div",{className:"flag-and-code",children:[e.jsx("img",{src:`https://flagcdn.com/24x18/${M}.png`,alt:k,title:k,className:"flag-icon",loading:"lazy"}),e.jsx("span",{className:"country-code",children:M.toUpperCase()})]}):e.jsxs("span",{className:"flag-and-code",title:k,role:"img","aria-label":"unknown country",children:["ðŸŒ ",e.jsx("span",{className:"country-code",children:"N/A"})]}),j.id]})})()},j.id))})]},o)})})]})})}function re(){const[n,a]=p.useState(null),[l,i]=p.useState(!0),s=p.useRef(),t=p.useMemo(()=>W(),[]),c=V;p.useEffect(()=>{var u;if(n)(u=s.current)==null||u.highlightShark(n.id),i(!1);else{if(s.current){const g=s.current.getGlobe();E(g),O(g,t)}i(!0)}},[n]),p.useEffect(()=>{if(s.current){const u=s.current.getGlobe();E(u),O(u,t)}},[]);const m=u=>{if(typeof u=="object"&&u.lat!==void 0&&u.lng!==void 0){if(!l){console.log("Ignoring click because not all sharks are visible.");return}const{lat:g,lng:f}=u;console.log("Clicked at lat/lng:",g,f);const r=3,d=t.find(h=>{const x=Math.abs(h.lat-g),v=Math.abs(h.lng-f);return x<r&&v<r});if(d){const h=d.id.split("-")[0];console.log("Matched shark:",d.id," with ID: ",h);const x=c.find(v=>v.id==h)||null;console.log("Sending shark obect:",x),a(x)}else console.log("No nearby shark found."),a(null)}else{const g=c.find(f=>f.id==u)||null;a(g)}},b=()=>{a(null),i(!0)};return e.jsx("div",{className:"page-content globeviews-wrapper",children:e.jsxs("div",{className:"globe-views-container",children:[e.jsx("div",{className:"info-sidebar",children:e.jsx(J,{shark:n})}),e.jsx("div",{className:"globe-container",children:e.jsx(_,{ref:s,onSharkClick:m,allowClicks:!n})}),e.jsx("div",{className:"shark-selector",children:e.jsx(se,{sharks:c,onSelect:m,onReset:b,selectedSharkId:n?n.id:null})})]})})}export{re as default};
