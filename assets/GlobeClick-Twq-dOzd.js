import{r as x,b as F,j as e,f as R,p as v,h as k,i as U,R as w,F as E}from"./index-CwcZW0OQ.js";import{F as O}from"./FavoriteButton-JI8XLnpW.js";import{C as T}from"./ChartPlaceholder-C1DRv8kc.js";const A=({shark:s})=>{const[n,a]=x.useState(null),r=s&&s.image!=="Unknown"?F(s.image):[],t=i=>a(i),l=()=>a(null);return x.useEffect(()=>{if(n===null)return;const i=o=>{o.key==="ArrowLeft"?a(d=>Math.max(d-1,0)):o.key==="ArrowRight"?a(d=>Math.min(d+1,r.length-1)):o.key==="Escape"&&l()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[n,r.length]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"shark-images-container",children:[e.jsx("h3",{children:"Media Gallery"}),r.length>0?r.map((i,o)=>e.jsxs("div",{className:"shark-image-card",children:[e.jsx("img",{src:i.url,alt:`Shark image ${o}`,onClick:()=>t(o),style:{cursor:"pointer"}}),e.jsx("p",{className:"shark-image-meta",children:e.jsxs("small",{children:["ðŸ“¸ Creator: ",i.creator," | ",i.license]})})]},o)):e.jsx("p",{children:"No media available."})]}),n!==null&&e.jsx("div",{className:"image-overlay",onClick:l,children:e.jsxs("div",{className:"overlay-content",onClick:i=>i.stopPropagation(),children:[e.jsx("button",{className:"carousel-button left",onClick:()=>a(i=>Math.max(i-1,0)),disabled:n===0,children:"< "}),e.jsxs("div",{className:"overlay-image-wrapper",children:[e.jsx("img",{src:r[n].url,alt:`Expanded shark image ${n}`}),e.jsxs("p",{className:"overlay-meta",children:["ðŸ“¸ Creator: ",r[n].creator," | ",r[n].license]})]}),e.jsx("button",{className:"carousel-button right",onClick:()=>a(i=>Math.min(i+1,r.length-1)),disabled:n===r.length-1,children:"> "}),e.jsx("button",{className:"close-button",onClick:l,children:"X"})]})})]})},q=({shark:s})=>{if(!s)return e.jsxs("div",{className:"shark-info-panel",children:[e.jsx("h2",{children:"Select a whale shark to view its records"}),e.jsx(T,{type:"globeViews",message:""})]});const n=s.countries.split(",").map(l=>l.trim()),a=s.regions?s.regions.split(",").map(l=>l.trim()):[],r=s.publishing?s.publishing.split(",").map(l=>l.trim()):[],t=s.remarks||"";return e.jsxs("div",{className:"shark-info-panel",children:[e.jsxs("h2",{children:["ID: ",s.id,e.jsx(O,{sharkId:s.id})]}),e.jsxs("div",{className:"shark-panel-details",children:[e.jsxs("div",{className:"shark-traits",children:[e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Sex:"}),"Â  ",s.sex]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Life Stage:"}),"Â  ",s.lifeStage]})]}),e.jsxs("div",{className:"shark-records",children:[e.jsxs("h3",{className:"shark-details",children:[e.jsx("strong",{children:"Total Records:"}),"Â  ",s.occurrences]}),e.jsxs("p",{className:"shark-details",children:[s.oldest," Â ...Â  ",s.newest]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Satellite tracking:"}),"Â Â ",Math.round(s.machine/(s.machine+s.human)*100),"%"]}),e.jsxs("p",{className:"shark-details",children:[e.jsx("strong",{children:"Human sightings:"}),"Â Â ",Math.round(s.human/(s.machine+s.human)*100),"%"]})]}),e.jsxs("div",{className:"shark-regions",children:[e.jsx("h3",{className:"shark-details",children:"Places Visited"}),e.jsx("ul",{className:"timeline-list",children:n.map((l,i)=>{const o=a[i]||"Unknown",d=r[i]||"Unspecified",u=t||"None",m=R(o),h=R(l),p=m!=="Unknown"?m:h;return e.jsxs("li",{className:"timeline-item",children:[e.jsxs("div",{className:"timeline-header",children:[e.jsx("strong",{children:v(l)})," ",e.jsxs("span",{className:"timeline-date",children:["(",p,")"]})]}),e.jsxs("div",{className:"timeline-region",children:[e.jsx("span",{className:"timeline-label",children:"Region:"})," ",e.jsx("em",{children:o!=="Unknown"?v(o):"Unspecified"})]}),e.jsxs("div",{className:"timeline-meta",children:[e.jsx("span",{className:"timeline-label",children:"Published by:"})," ",e.jsx("em",{children:d!=="Unknown"?d:"Unspecified"})]}),e.jsxs("div",{className:"timeline-remarks",children:[e.jsx("span",{className:"timeline-label",children:"Sighting remarks:"})," ",e.jsx("em",{children:u!=="Unknown"?k(u):"None"})]})]},i)})})]}),e.jsx(A,{shark:s})]})]})};function D({criteria:s,onChange:n}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Media"}),e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.showOnlyWithMedia,onChange:()=>n({...s,showOnlyWithMedia:!s.showOnlyWithMedia})}),"Sharks with real-world images"]})]})}function B({criteria:s,onChange:n,countries:a,publishingCountries:r}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Location"}),e.jsxs("label",{className:"filter-label",children:["Country:",e.jsxs("select",{value:s.country,onChange:t=>n({...s,country:t.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),a.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("label",{className:"filter-label",children:["Publishing Country:",e.jsxs("select",{value:s.publishingCountry,onChange:t=>n({...s,publishingCountry:t.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),r.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})}function H({criteria:s,onChange:n,minYear:a,maxYear:r,months:t}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Time"}),e.jsxs("label",{className:"filter-label",children:["Year Range:",e.jsxs("div",{className:"range-inputs",children:[e.jsx("input",{type:"number",value:s.yearRange[0],onChange:l=>{const i=l.target.value;n({...s,yearRange:[i,s.yearRange[1]]})},onBlur:()=>{const l=parseInt(s.yearRange[0]),i=isNaN(l)?a:Math.max(a,Math.min(l,parseInt(s.yearRange[1])));n({...s,yearRange:[String(i),s.yearRange[1]]})},className:"filter-input"}),e.jsx("span",{style:{margin:"0 0.25rem"},children:"to"}),e.jsx("input",{type:"number",value:s.yearRange[1],onChange:l=>{const i=l.target.value;n({...s,yearRange:[s.yearRange[0],i]})},onBlur:()=>{const l=parseInt(s.yearRange[1]),i=isNaN(l)?r:Math.min(r,Math.max(l,parseInt(s.yearRange[0])));n({...s,yearRange:[s.yearRange[0],String(i)]})},className:"filter-input"})]})]}),e.jsxs("label",{className:"filter-label",children:["Month:",e.jsxs("select",{value:s.month,onChange:l=>n({...s,month:l.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),t.map(l=>e.jsx("option",{value:l,children:l},l))]})]})]})}function P({criteria:s,onChange:n,minRecords:a,maxRecords:r}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Metadata"}),e.jsxs("label",{className:"filter-label",children:[e.jsx("input",{type:"checkbox",checked:s.hasOccurrenceNotes,onChange:()=>n({...s,hasOccurrenceNotes:!s.hasOccurrenceNotes})}),"Sharks with occurrence notes"]}),e.jsxs("label",{className:"filter-label",children:["Min Records:",e.jsx("input",{type:"number",min:a,max:r,value:s.minRecords,onChange:t=>{const l=t.target.value;n({...s,minRecords:l})},onBlur:()=>{const t=parseInt(s.minRecords,10);if(isNaN(t)){n({...s,minRecords:a});return}const l=Math.max(a,Math.min(t,r));n({...s,minRecords:l})},className:"filter-input"})]})]})}function $({criteria:s,onChange:n}){return e.jsxs("fieldset",{className:"filter-group",children:[e.jsx("legend",{children:"Biological"}),e.jsxs("label",{className:"filter-label",children:["Sex:",e.jsxs("select",{value:s.sex,onChange:a=>n({...s,sex:a.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"filter-label",children:["Life Stage:",e.jsxs("select",{value:s.lifeStage,onChange:a=>n({...s,lifeStage:a.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Juvenile",children:"Juvenile"}),e.jsx("option",{value:"Subadult",children:"Subadult"}),e.jsx("option",{value:"Adult",children:"Adult"}),e.jsx("option",{value:"Unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"filter-label",children:["Observation Type:",e.jsxs("select",{value:s.observationType,onChange:a=>n({...s,observationType:a.target.value}),className:"filter-select",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Satellite",children:"Satellite Tracking"}),e.jsx("option",{value:"Human",children:"Human Sightings"})]})]})]})}function W({criteria:s,onChange:n,options:a}){const{countries:r=[],publishingCountries:t=[],minYear:l=2e3,maxYear:i=2024,months:o=[],minRecords:d=1,maxRecords:u=100}=a;return e.jsxs("div",{className:"shark-filters scrollable-filters",children:[e.jsx(D,{criteria:s,onChange:n}),e.jsx(B,{criteria:s,onChange:n,countries:r,publishingCountries:t}),e.jsx(H,{criteria:s,onChange:n,minYear:l,maxYear:i,months:o}),e.jsx(P,{criteria:s,onChange:n,minRecords:d,maxRecords:u}),e.jsx($,{criteria:s,onChange:n})]})}function M(s,n){return Array.from(new Set(s.flatMap(a=>{var r;return((r=a[n])==null?void 0:r.split(",").map(t=>v(t).trim()).filter(Boolean))||[]}))).sort((a,r)=>a.localeCompare(r))}function Y(s,n){return s.filter(a=>{var r;if(n.showOnlyWithMedia&&!(a.image&&a.image.trim()!==""&&a.image!=="Unknown")||n.country&&!(a.countries||"").split(",").map(i=>v(i).toLowerCase().trim()).some(i=>i.includes(n.country.toLowerCase()))||n.publishingCountry&&!(a.publishing||"").split(",").map(i=>v(i).toLowerCase().trim()).some(i=>i.includes(n.publishingCountry.toLowerCase())))return!1;if(n.yearRange){const t=parseInt(a.oldest),l=parseInt(a.newest),i=parseInt(n.yearRange[0]),o=parseInt(n.yearRange[1]);if(isNaN(t)||isNaN(l)||l<i||t>o)return!1}if(n.month&&!a.months.some(l=>l.includes(n.month))||n.hasOccurrenceNotes&&k(a.remarks)==="None"||n.minRecords>0&&a.occurrences<n.minRecords||n.sex&&(((r=a.sex)==null?void 0:r.toLowerCase())||"")!==n.sex.toLowerCase()||n.lifeStage&&U(a).toLowerCase()!==n.lifeStage.toLowerCase())return!1;if(n.observationType){let t=!0;if(n.observationType=="Satellite"?t=a.machine>0:n.observationType=="Human"&&(t=a.human>0),!t)return!1}return!0})}function K({sharks:s,onReset:n,onSelect:a,selectedSharkId:r,DisplayComponent:t,disabled:l=!1,onFilteredSharksChange:i}){const o=M(s,"countries"),d=M(s,"publishing"),u=Math.min(...s.map(c=>c.occurrences||1)),m=Math.max(...s.map(c=>c.occurrences||1)),h=s.flatMap(c=>[parseInt(c.oldest),parseInt(c.newest)]).filter(c=>!isNaN(c)),p=Math.min(...h),f=Math.max(...h),j=E,N=w.useMemo(()=>({showOnlyWithMedia:!1,country:"",yearRange:[String(p),String(f)],month:"",hasOccurrenceNotes:!1,minRecords:1,sex:"",lifeStage:"",publishingCountry:"",observationType:""}),[p,f]),[g,S]=x.useState(N),[b,C]=x.useState(!0),I=()=>{S(N),n&&n()},y=w.useMemo(()=>{console.log("Computing filteredSharks with criteria:",g);const c=Y(s,g);return console.log(`filterSharks result: ${c.length}/${s.length} sharks`),c},[s,g]);w.useEffect(()=>{i&&i(y)},[y,i]);const L={countries:o,publishingCountries:d,minYear:p,maxYear:f,months:j,minRecords:u,maxRecords:m};return e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%",opacity:l?.6:1,pointerEvents:l?"none":"auto"},children:e.jsxs("div",{className:"shark-selector-list",children:[e.jsx("button",{onClick:I,className:`show-all-button ${r==null?"active":""}`,disabled:l,children:"Show All Sharks"}),e.jsxs("div",{className:"filter-toggle-container",children:[e.jsx("button",{onClick:()=>C(c=>!c),className:`toggle-filter-button ${b?"active":""}`,disabled:l,children:b?"Hide Filters â–²":"Show Filters â–¼"}),b&&e.jsx(W,{criteria:g,onChange:S,options:L,disabled:l})]}),e.jsx(t,{sharks:y,onSelect:a,selectedSharkId:r,disabled:l})]})})}function X({sharks:s,pointsData:n,allSharksVisible:a,onSharkSelect:r}){const t=x.useRef(s),l=x.useRef(n),i=x.useRef(a),o=x.useRef(r);return x.useEffect(()=>{t.current=s,l.current=n,i.current=a,o.current=r}),u=>{if(typeof u=="object"&&u.lat!==void 0&&u.lng!==void 0){if(!i.current){console.log("Ignoring click because not all sharks are visible.");return}const{lat:m,lng:h}=u;console.log("Clicked at lat/lng:",m,h);const p=3,f=l.current.find(j=>{const N=Math.abs(j.lat-m),g=Math.abs(j.lng-h);return N<p&&g<p});if(f){const j=f.id.split("-")[0];console.log("Matched shark:",f.id," with ID: ",j);const N=t.current.find(g=>g.id==j)||null;console.log("Sending shark object:",N),o.current(N)}else console.log("No nearby shark found."),o.current(null)}else{const m=t.current.find(h=>h.id==u)||null;o.current(m)}}}export{q as S,K as a,X as u};
